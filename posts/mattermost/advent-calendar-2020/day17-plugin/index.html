<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>[Mattermost Integrations] Plugin基本編</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-57299975-4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-57299975-4')</script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.kaakaa.dev/index.xml title="kaakaa blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="[Mattermost Integrations] Plugin基本編"><meta name=twitter:description content="Mattermost記事まとめ: https://blog.kaakaa.dev/tags/mattermost/ 本記事について Mattermostの統合機能アドベントカレンダーの第17日目の記事です。 本記事では、Mat"><link rel=stylesheet href=https://blog.kaakaa.dev/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://blog.kaakaa.dev/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://blog.kaakaa.dev/js/bundle.js></script><script src=https://blog.kaakaa.dev/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.82.0"></head><body><header><nav class=navbar><div class=nav><ul class=nav-links><li><a href=/ id=Home><em class="fas fa-home fa-lg"></em></a></li><li><a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags/ id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/search/ id=Search><em class="fas fa-search fa-lg"></em></a></li><li><a href=/index.xml id=Subscribe><em class="fas fa-rss fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>[Mattermost Integrations] Plugin基本編</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>Mattermost記事まとめ: <a href=https://blog.kaakaa.dev/tags/mattermost/>https://blog.kaakaa.dev/tags/mattermost/</a></p><nav id=TableOfContents><ul><li><a href=#本記事について>本記事について</a></li><li><a href=#mattermost-plugin>Mattermost Plugin</a></li><li><a href=#mattermost-pluginの使用>Mattermost Pluginの使用</a><ul><li><a href=#設定>設定</a></li><li><a href=#インストール>インストール</a></li><li><a href=#実行>実行</a></li></ul></li><li><a href=#mattermost-pluginの開発>Mattermost Pluginの開発</a></li><li><a href=#mattermost-demo-plugin>Mattermost Demo Plugin</a></li><li><a href=#さいごに>さいごに</a></li></ul></nav><h2 id=本記事について>本記事について</h2><p><a href=https://qiita.com/advent-calendar/2020/mattermost-integrations>Mattermostの統合機能アドベントカレンダー</a>の第17日目の記事です。</p><p>本記事では、Mattermostのプラグイン機能について紹介します。Mattermost Pluginは機能が多いため、本日はMattermostの概要と使い方、Mattermost公式チームが用意しているMattermost Plugin開発のためのテンプレートプロジェクトの紹介までを行います。</p><h2 id=mattermost-plugin>Mattermost Plugin</h2><p>Mattermost Pluginは、Mattermostの様々な箇所に存在する拡張ポイントを使ってより幅広く、コアに近い部分に処理を差し込むことができる機能です。今まで紹介してきた統合機能に比べて、下記２点で優れていると個人的に思っています。</p><ol><li>投稿以外のユーザーの行動に対して独自の処理を追加することができる</li><li>Mattermostと同じサーバー上で動かすことができ、プロセス管理もMattermostに任せられる</li></ol><p><code>1.</code>の点については、今まで紹介してきた統合機能は、メッセージの投稿やSlash Commandの実行などMattermost上で投稿操作が行われた際に独自の処理を実行することができるというものでした。しかし、Plugin機能では、ユーザーによる投稿操作の他にもチャンネル/チームへの参加/脱退やチャンネル作成時など、Mattermost上の様々な操作に反応して独自の処理を実行させることができます。また、投稿操作についても、投稿がデータベースに保存される前後で処理を実行することができるため、投稿が作成される前にRejectするようなこともできます。</p><p><code>2.</code>の点についてはWebSocket APIを使うことで実現できたかもしれませんが、WebSocket APIを始めMattermostの統合機能を使うには、Mattermostとは別に統合機能からのリクエストを受け取るサーバーアプリケーションを構築しておく必要がありました。しかし、Mattermost Pluginは、そのプロセス管理をMattermost自身が行うため、Mattermost以外のサーバーを管理する必要はありません。これが<code>2.</code>の利点です。さらに、Mattermost PluginではPlugin用のKey-Valueストアも用意されているため、簡単なデータの保持であればMattermostに任せることができます。</p><p>Mattermost Pluginは、サーバー側で動作する<strong>Server</strong>サイドのプラグインとブラウザ上で動作する<strong>Webapp</strong>サイドのプラグインがあります。一つのPluginに両方の機能を持たせても良いですし、どちらか一方の機能だけのPluginを実装することもできます。</p><h2 id=mattermost-pluginの使用>Mattermost Pluginの使用</h2><p>まず、Mattermost Pluginを使ってみるところから紹介します。</p><p>今回は、私も開発に参加しているMattermost上で投票機能を作成することができる<a href=https://github.com/matterpoll/matterpoll>Matterpollプラグイン</a>を手動でインストールしてみます。</p><p><a href=https://github.com/matterpoll/matterpoll>https://github.com/matterpoll/matterpoll</a></p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day17/matterpoll.png alt=matterpoll></p><h3 id=設定>設定</h3><p>まず、Mattermost Pluginを使うには、<strong>システムコンソール > プラグイン管理 > プラグインを有効にする</strong>が<code>有効</code>になっている必要があります。</p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day17/config-plugin.png alt="config plugin"></p><p>また、手動でプラグインのインストールを行う場合、<strong>システムコンソール > プラグイン管理 > プラグインをアップロードする</strong>の<code>ファイルを選択する</code>が有効になっている必要があります。もし、このボタンが無効化されている場合は、Mattermostが起動しているサーバーのMattermostインストールディレクトリにある<code>config/config.json</code>の<code>EnableUploads</code>を<code>true</code>にし、Mattermostを再起動する必要があります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-config.json data-lang=config.json>    <span style=color:#960050;background-color:#1e0010>...</span>
    <span style=color:#e6db74>&#34;PluginSettings&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
        <span style=color:#f92672>&#34;Enable&#34;</span>: <span style=color:#66d9ef>true</span>,
        <span style=color:#f92672>&#34;EnableUploads&#34;</span>: <span style=color:#66d9ef>true</span>,
    <span style=color:#960050;background-color:#1e0010>...</span>
</code></pre></div><h3 id=インストール>インストール</h3><p>Pluginを使用する設定が完了したら、以下のページから<code>com.github.matterpoll.matterpoll-1.4.0.tar.gz</code>をダウンロードして、<strong>システムコンソール > プラグイン管理 > プラグインをアップロードする</strong>からアップロードします。</p><p><a href=https://github.com/matterpoll/matterpoll/releases/tag/v1.4.0>https://github.com/matterpoll/matterpoll/releases/tag/v1.4.0</a></p><p>(Matterpoll v1.4.0は<strong>Mattermost v5.20</strong>以上を対象としているため、それより古いバージョンを使用している場合は、Matterpollも古いバージョンのものをお使いください)</p><p>インストールが正常に終了すると、<code>インストール済みプラグイン</code>のところにMatterpollが表示されます。Matterpollプラグインのところにある<code>有効にする</code>のリンクをクリックすることでプラグインを有効にできます。</p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day17/install-plugin.png alt="install plugin"></p><h3 id=実行>実行</h3><p>Matterpollプラグインが問題なく起動できれば、Matterpollの機能が利用できるようになっています。MatterpollはSlash Commandで投票を作成するため、チャンネルに戻り <code>/poll help</code> と打つと、Matterpollのヘルプメッセージが出てきます。</p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day17/execute-plugin.png alt="execute plugin"></p><h2 id=mattermost-pluginの開発>Mattermost Pluginの開発</h2><p>先ほども見たように、Mattermost Pluginの本体は<code>.tar.gz</code>ファイルになります。この<code>.tar.gz</code>ファイルには、プラグインのマニフェストファイルや、Serverサイド機能のバイナリ、Webappサイドの<code>.js</code>ファイルなどが含まれています。</p><p>毎回一からこれらを用意するのは大変なため、MattermostチームはMattermost Plugin開発用のテンプレートリポジトリを公開しています。</p><p><a href=https://github.com/mattermost/mattermost-plugin-starter-template>https://github.com/mattermost/mattermost-plugin-starter-template</a></p><p>このテンプレートリポジトリを使ったMattermost Pluginの開発方法は、以下の記事で既に紹介しているため、ここでの説明は割愛します。</p><p><a href=https://qiita.com/kaakaa_hoe/items/6f3d1aa0a126f2e94e01>Mattermostプラグイン用のGitHubリポジトリテンプレートを使ってみる - Qiita</a></p><h2 id=mattermost-demo-plugin>Mattermost Demo Plugin</h2><p>Mattermost PluginではMattermostの様々な箇所を拡張できますが、Pluginで拡張できる箇所を紹介するDemo用のプラグインが公開されています。</p><p><a href=https://github.com/mattermost/mattermost-plugin-demo>https://github.com/mattermost/mattermost-plugin-demo</a></p><p>このプラグインをインストールすることで、全てではないですがMattermost Pluginで拡張可能な箇所を確認できます。</p><h2 id=さいごに>さいごに</h2><p>本日は、Mattermost Pluginの概要や使い方について紹介しました。
明日からは、Mattermost Pluginで実現できる機能について紹介していきます。</p><div class=blog-tags><a href=https://blog.kaakaa.dev/tags/mattermost/>mattermost</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/integration/>integration</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/plugin/>plugin</a>&nbsp;</div></article><div id=disqus_thread></div><script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='kaakaa-blog',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div><a href=https://github.com/kaakaa name=GitHub><em class="fab fa-github-alt fa-lg"></em></a><a href=https://twitter.com/kaakaa_hoe_prog name=Twitter><em class="fab fa-twitter fa-lg"></em></a><a class=social-icon href=https://twitter.com/kaakaa_hoe_prog name=Qiita><img src=https://blog.kaakaa.dev/images/qiita.png width=20 height=20 alt=Qiita></a></div><div class=container><p class="credits copyright"><a href=https://blog.kaakaa.dev/about>Yusuke Nemoto</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://blog.kaakaa.dev/>kaakaa blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>