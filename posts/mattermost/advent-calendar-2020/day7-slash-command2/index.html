<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>[Mattermost Integrations] Slash Command 発展編</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-57299975-4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-57299975-4')</script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.kaakaa.dev/index.xml title="kaakaa blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="[Mattermost Integrations] Slash Command 発展編"><meta name=twitter:description content="Mattermost記事まとめ: https://blog.kaakaa.dev/tags/mattermost/ 本記事について Mattermostの統合機能アドベントカレンダーの第7日目の記事です。 前回の記事では、Ma"><meta property="og:title" content="[Mattermost Integrations] Slash Command 発展編"><meta property="og:description" content="Mattermost記事まとめ: https://blog.kaakaa.dev/tags/mattermost/ 本記事について Mattermostの統合機能アドベントカレンダーの第7日目の記事です。 前回の記事では、Ma"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kaakaa.dev/posts/mattermost/advent-calendar-2020/day7-slash-command2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-07T00:00:00+09:00"><meta property="article:modified_time" content="2020-12-07T00:00:00+09:00"><link rel=stylesheet href=https://blog.kaakaa.dev/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://blog.kaakaa.dev/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://blog.kaakaa.dev/js/bundle.js></script><script src=https://blog.kaakaa.dev/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.82.0"></head><body><header><nav class=navbar><div class=nav><a href=https://blog.kaakaa.dev/ class=nav-logo><img src=https://blog.kaakaa.dev/images/icon.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/ id=Home><em class="fas fa-home fa-lg"></em></a></li><li><a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags/ id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/search/ id=Search><em class="fas fa-search fa-lg"></em></a></li><li><a href=/index.xml id=Subscribe><em class="fas fa-rss fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>[Mattermost Integrations] Slash Command 発展編</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>Mattermost記事まとめ: <a href=https://blog.kaakaa.dev/tags/mattermost/>https://blog.kaakaa.dev/tags/mattermost/</a></p><nav id=TableOfContents><ul><li><a href=#本記事について>本記事について</a></li><li><a href=#slash-commandのレスポンスとして投稿を作成する>Slash Commandのレスポンスとして投稿を作成する</a></li><li><a href=#slash-commandレスポンスパラメータ>Slash Commandレスポンスパラメータ</a><ul><li><a href=#text><code>text</code></a></li><li><a href=#response_type><code>response_type</code></a></li><li><a href=#username-icon_url><code>username</code>, <code>icon_url</code></a></li><li><a href=#channel_id><code>channel_id</code></a></li><li><a href=#goto_location><code>goto_location</code></a></li><li><a href=#attachments><code>attachments</code></a></li><li><a href=#type><code>type</code></a></li><li><a href=#extra_responses><code>extra_responses</code></a></li><li><a href=#skip_slack_parsing><code>skip_slack_parsing</code></a></li><li><a href=#props><code>props</code></a></li></ul></li><li><a href=#slash-commandで時間のかかる処理を実行する場合>Slash Commandで時間のかかる処理を実行する場合</a></li><li><a href=#さいごに>さいごに</a></li></ul></nav><h2 id=本記事について>本記事について</h2><p><a href=https://qiita.com/advent-calendar/2020/mattermost-integrations>Mattermostの統合機能アドベントカレンダー</a>の第7日目の記事です。</p><p>前回の記事では、Mattermostで<code>/</code>で始まるコマンドを実行することで、特定の処理を実行することができるSlash Commandの機能について紹介しました。また、Custom Slash Commandにより外部アプリケーションにリクエストを送信する方法を紹介しました。本記事では、Custome Slash Commandのリクエストが送信された外部アプリケーション側からMattermost側へ返却するレスポンス内容について紹介します。</p><h2 id=slash-commandのレスポンスとして投稿を作成する>Slash Commandのレスポンスとして投稿を作成する</h2><p>Slash Commandによるリクエストを受け付けた外部アプリケーションから、レスポンスとしてMattermostに投稿を作成する方法について紹介します。</p><p>以下のコードは昨日のコードにレスポンスを返すコードを追加したものです。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;fmt&#34;</span>
	<span style=color:#e6db74>&#34;io&#34;</span>
	<span style=color:#e6db74>&#34;log&#34;</span>
	<span style=color:#e6db74>&#34;net/http&#34;</span>
)

<span style=color:#66d9ef>const</span> (
	<span style=color:#a6e22e>WebHookToken</span> = <span style=color:#e6db74>&#34;8w7foap4ufrsfczda8uez51yxo&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/command&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%#v&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>)
		<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ParseForm</span>()

		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;token: %v&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;token&#34;</span>))
		<span style=color:#75715e>// (1) Tokenをチェック
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;token&#34;</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>WebHookToken</span> {
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;received an invalid request with token: %s&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;token&#34;</span>))
			<span style=color:#66d9ef>return</span>
		}

		<span style=color:#75715e>// (2) レスポンスとしてMattermostへ投稿を作成
</span><span style=color:#75715e></span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
		<span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>`{&#34;text&#34;: &#34;**%s**&#34;}`</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;text&#34;</span>)))
	})
	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>)
}
</code></pre></div><p>Outgoing WebHookの時とほぼ同じですが、<code>(1)</code> でトークンを利用したリクエストの検証を行い、<code>(2)</code> でSlash Commandのレスポンスとして投稿を作成しています。レスポンスヘッダーへの<code>Content-Type: application/json</code>の設定は必須です。<code>text</code>フィールドに指定したメッセージがMattermostに投稿されます。</p><p>このサーバに対して<code>/サンプルコマンド TEST</code>というSlash Commandを送信した時の画面が下記になります。</p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/response-slash-command.png alt=response></p><p>作成された投稿には、<code>BOT</code>というラベルに加え、<code>(あなただけが見ることができます)</code>というメッセージがついています。Slash Commandのレスポンスとして作成した投稿は、デフォルトではSlash Commandを実行したユーザーしか見ることができない投稿になり、他のユーザーからは見ることができません。チャンネルの全員が閲覧可能な投稿を作成するには、後述の<code>response_type</code>パラメータを設定します。</p><h2 id=slash-commandレスポンスパラメータ>Slash Commandレスポンスパラメータ</h2><h3 id=text><code>text</code></h3><p>投稿されるメッセージであり、後述の<code>attachments</code>を指定しない場合は必須のパラメータです。Markdown記法や、<code>@</code>によるメンションを投稿することもできます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{&#34;text&#34;: &#34;**TEST**&#34;}`</span>)
</code></pre></div><h3 id=response_type><code>response_type</code></h3><p>Slash Commandのレスポンスにより作成される投稿の種別を指定します。デフォルトでは<code>ephemeral</code>であり、Slash Commandを実行したユーザーにしか見えない投稿になります。チャンネル全員が見えるようにするには<code>response_type</code>に<code>in_channel</code>を指定します。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{&#34;text&#34;: &#34;**TEST**&#34;, &#34;response_type&#34;: &#34;in_channel&#34;}`</span>)
</code></pre></div><h3 id=username-icon_url><code>username</code>, <code>icon_url</code></h3><p>Slash Commandのレスポンスとして作成される投稿のユーザー名とアイコンの表示を変更することができます。デフォルトでは、ウェブフックを作成したユーザーになります。</p><p>このパラメータを使用する場合、システムコンソールから下記の設定をそれぞれ<code>有効</code>にする必要があります。</p><ul><li><strong>システムコンソール > 統合機能管理 > 統合機能によるユーザー名の上書きを許可する</strong></li><li><strong>システムコンソール > 統合機能管理 > 統合機能によるプロフィール画像アイコンの上書きを許可する</strong></li></ul><p>（この設定を有効にすると、<code>username</code>と<code>icon_url</code>を指定しない場合の投稿の作成者がデフォルトのアイコン、ユーザー名(<code>webhook</code>)に変更されます）</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{
</span><span style=color:#e6db74>	&#34;text&#34;: &#34;**TEST**&#34;,
</span><span style=color:#e6db74>	&#34;username&#34;: &#34;new-bot&#34;, 
</span><span style=color:#e6db74>	&#34;icon_emoji&#34;: &#34;http://www.mattermost.org/wp-content/uploads/2016/04/icon_WS.png&#34;
</span><span style=color:#e6db74>}`</span>)
</code></pre></div><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/example-overwrite.png alt="use overwrite"></p><h3 id=channel_id><code>channel_id</code></h3><p>投稿を作成するチャンネルを指定できます。ここで指定するチャンネルIDは、<strong>チャンネルメニュー > 情報を表示する</strong>から確認できます。</p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/view-channel-id1.png alt="channel info view"></p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/view-channel-id2.png alt="channel info view"></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{
</span><span style=color:#e6db74>	&#34;text&#34;: &#34;**TEST**&#34;,
</span><span style=color:#e6db74>	&#34;channel_id&#34;: &#34;u6ijofzg8bnsie5u8c1eumtc1h&#34;
</span><span style=color:#e6db74>}`</span>)
</code></pre></div><h3 id=goto_location><code>goto_location</code></h3><p>Slash Command特有のパラメータです。<code>goto_location</code>フィールドにURLを指定しておくと、Slash Commandが実行された際に指定されたURLに移動します。この時<code>text</code>などで指定した投稿も作成されます。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{
</span><span style=color:#e6db74>	&#34;text&#34;: &#34;**TEST**&#34;,
</span><span style=color:#e6db74>	&#34;goto_location&#34;: &#34;https://github.com/mattermost&#34;
</span><span style=color:#e6db74>}`</span>)
</code></pre></div><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/example-goto-location.gif alt=movie></p><p><code>goto_location</code>には<code>https</code>だけでなく、<code>ssh</code>や<code>mailto</code>のプロトコルも使用できるため、例えばスラッシュコマンドを実行した場合に「メーラーでメール作成画面を開く」というような動作をさせることも可能です。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{
</span><span style=color:#e6db74>	&#34;text&#34;: &#34;**TEST**&#34;,
</span><span style=color:#e6db74>	&#34;goto_location&#34;: &#34;mailto:test@example.com&#34;
</span><span style=color:#e6db74>}`</span>)
</code></pre></div><h3 id=attachments><code>attachments</code></h3><p><code>attachments</code>は、Mattermostにリッチな投稿を作成することができる<a href=https://docs.mattermost.com/developer/message-attachments.html>MessageAttachments</a>を指定できる機能です。<a href=https://docs.mattermost.com/developer/message-attachments.html>MessageAttachments</a>については、別途紹介記事を用意する予定です。</p><h3 id=type><code>type</code></h3><p><code>type</code>は、Mattermostの投稿の種別を指定するパラメータですが、基本的に使用することはありません。Plugin(Webapp)にてプラグイン独自の投稿種別を指定した場合のみに使用するものかと思います。Plugin(Webapp)については、別途紹介記事を用意する予定です。</p><h3 id=extra_responses><code>extra_responses</code></h3><p><code>extra_responses</code>配列としてレスポンスのJSONデータを記述することで複数の投稿を作成することができます。
<code>extra_responses</code>が導入されるMattermost v5.6以前は、Slash Commandのレスポンスとして複数の投稿を作成したい場合はREST APIを実行するなどをしなくてはなりませんでしたが、<code>extra_responses</code>によってREST APIを実行するためのコードなどが必要なくなりました。</p><p>Slash Commandのリクエストに対して下記のレスポンスを返却すると、「チャンネル全員が閲覧できる投稿を作りつつ、コマンド実行ユーザーのみにしか見えない投稿も合わせて作成し、さらに、別のチャンネルにコマンドが実行されたことを通知する」ということができるようになります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{
</span><span style=color:#e6db74>	&#34;text&#34;: &#34;**TEST**&#34;,
</span><span style=color:#e6db74>	&#34;response_type&#34;: &#34;in_channel&#34;,
</span><span style=color:#e6db74>	&#34;extra_responses&#34;: [
</span><span style=color:#e6db74>		{
</span><span style=color:#e6db74>			&#34;text&#34;: &#34;**Secret Info**&#34;
</span><span style=color:#e6db74>		},
</span><span style=color:#e6db74>		{
</span><span style=color:#e6db74>			&#34;text&#34;: &#34;Notify in other channel&#34;,
</span><span style=color:#e6db74>			&#34;channel_id&#34;: &#34;u6ijofzg8bnsie5u8c1eumtc1h&#34;
</span><span style=color:#e6db74>		}
</span><span style=color:#e6db74>	]
</span><span style=color:#e6db74>}`</span>)
</code></pre></div><p><code>extra_responses</code>内にさらに<code>extra_responses</code>を指定することはできず、また、<code>goto_location</code>も使用できません。</p><h3 id=skip_slack_parsing><code>skip_slack_parsing</code></h3><p>Mattermostの統合機能はSlack記法との互換性を意識して作成されていますが、<code>skip_slack_parsing</code>に<code>true</code>を指定すると、レスポンスとして返却した<code>text</code>をSlack互換の記法として解析しないようになります。あまり使うことは無いかと思いますが、レスポンスが想定どおりに投稿されない場合などに利用を検討してみても良いかもしれません。</p><p>このパラメータが追加されたきっかけとなったのは下記のIssueです。
<a href=https://github.com/mattermost/mattermost-server/issues/12702>slack-compatibility-layer seems to break results of MM-only integration · Issue #12702 · mattermost/mattermost-server</a></p><h3 id=props><code>props</code></h3><p>Incoming WebHookなどと同様、投稿のメタデータを格納するフィールドです。Incoming WebHookと同様、<code>card</code>も利用することができます。</p><h2 id=slash-commandで時間のかかる処理を実行する場合>Slash Commandで時間のかかる処理を実行する場合</h2><p>単にSlash Commandのレスポンスとして投稿を作成できるだけだと、外部アプリケーションで時間のかかる処理を実行し、その結果を返したいという場合、Mattermost上のユーザーはコマンドを実行してから結果が返るまで何の反応も得ることができません。それを回避するため、Slash Command実行時に送信されるリクエストには、レスポンスを一度返した後で投稿を作成ことができるURLである<code>response_url</code>フィールドを持っています。</p><p><code>response_url</code>を使ったコードは下記のようになります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go:main.go data-lang=go:main.go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;io&#34;</span>
	<span style=color:#e6db74>&#34;log&#34;</span>
	<span style=color:#e6db74>&#34;net/http&#34;</span>
	<span style=color:#e6db74>&#34;strings&#34;</span>
	<span style=color:#e6db74>&#34;time&#34;</span>
)

<span style=color:#66d9ef>const</span> (
	<span style=color:#a6e22e>WebHookToken</span> = <span style=color:#e6db74>&#34;8w7foap4ufrsfczda8uez51yxo&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/command&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
		<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ParseForm</span>()
		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;token&#34;</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>WebHookToken</span> {
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;received an invalid request with token: %s&#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;token&#34;</span>))
			<span style=color:#66d9ef>return</span>
		}

		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
		<span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>WriteString</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>`{&#34;text&#34;: &#34;Request is recieved. Results will return later.&#34;}`</span>)

		<span style=color:#75715e>// (1) 5秒後に &#34;response_url&#34; に対してリクエストを送信
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>url</span> <span style=color:#66d9ef>string</span>) {
			<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
			<span style=color:#a6e22e>body</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#e6db74>`{&#34;text&#34;: &#34;This is the result.&#34;, &#34;response_type&#34;: &#34;in_channel&#34;}`</span>)
			<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Post</span>(<span style=color:#a6e22e>url</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>, <span style=color:#a6e22e>body</span>)
		}(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Form</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;response_url&#34;</span>))
	})
	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>)
}
</code></pre></div><p>今までと同じようにレスポンスを返した後、5秒Sleepした後に<code>response_url</code>のURLに対してリクエストを送信しています</p><p><img src=https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day7/example-delayed-response.gif alt=movie></p><p><code>response_url</code>に送信するリクエストには、<code>goto_location</code>は使えませんでしたが、<code>response_type</code>や<code>extra_responses</code>などは使えるようです。</p><p>また、<code>response_url</code>が有効なのは、元のSlash Commandが実行されてから30分間のみで、5つまでの投稿を作成することができます。処理が30分以上かかる場合や、5つ以上の投稿を作成したい場合は、REST APIを利用するか、Pluginを利用する必要がありそうです。</p><h2 id=さいごに>さいごに</h2><p>本日は、Slash Commandの詳細な使い方について紹介しました。
明日は、REST APIの使い方について紹介していきます。</p><div class=blog-tags><a href=https://blog.kaakaa.dev/tags/mattermost/>mattermost</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/integration/>integration</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/command/>command</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/slashcommand/>slashcommand</a>&nbsp;</div></article><div id=disqus_thread></div><script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='kaakaa-blog',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div><a href=https://github.com/kaakaa name=GitHub><em class="fab fa-github-alt fa-lg"></em></a><a href=https://twitter.com/kaakaa_hoe_prog name=Twitter><em class="fab fa-twitter fa-lg"></em></a><a class=social-icon href=https://twitter.com/kaakaa_hoe_prog name=Qiita><img src=https://blog.kaakaa.dev/images/qiita.png width=20 height=20 alt=Qiita></a></div><div class=container><p class="credits copyright"><a href=https://blog.kaakaa.dev/about>Yusuke Nemoto</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://blog.kaakaa.dev/>kaakaa blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>