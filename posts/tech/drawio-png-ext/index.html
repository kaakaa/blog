<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>*.drawio.png と *.drawio.svg とはなんなのか</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-57299975-4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-57299975-4')</script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.kaakaa.dev/index.xml title="kaakaa blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="*.drawio.png と *.drawio.svg とはなんなのか"><meta name=twitter:description content="VS Code Draw.io Integrationの画像エクスポート機能 数ヶ月前に、VS CodeのDraw.io Integrationが話題になりました。 VSCo"><meta property="og:title" content="*.drawio.png と *.drawio.svg とはなんなのか"><meta property="og:description" content="VS Code Draw.io Integrationの画像エクスポート機能 数ヶ月前に、VS CodeのDraw.io Integrationが話題になりました。 VSCo"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kaakaa.dev/posts/tech/drawio-png-ext/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-28T23:16:05+09:00"><meta property="article:modified_time" content="2020-07-28T23:16:05+09:00"><link rel=stylesheet href=https://blog.kaakaa.dev/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://blog.kaakaa.dev/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://blog.kaakaa.dev/js/bundle.js></script><script src=https://blog.kaakaa.dev/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.82.0"></head><body><header><nav class=navbar><div class=nav><a href=https://blog.kaakaa.dev/ class=nav-logo><img src=https://blog.kaakaa.dev/images/icon.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/ id=Home><em class="fas fa-home fa-lg"></em></a></li><li><a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags/ id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/search/ id=Search><em class="fas fa-search fa-lg"></em></a></li><li><a href=/index.xml id=Subscribe><em class="fas fa-rss fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>*.drawio.png と *.drawio.svg とはなんなのか</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><nav id=TableOfContents><ul><li><a href=#vs-code-drawio-integrationの画像エクスポート機能>VS Code Draw.io Integrationの画像エクスポート機能</a></li><li><a href=#drawiopng-と-drawiosvg><code>*.drawio.png</code> と <code>*.drawio.svg</code></a></li><li><a href=#なぜ画像ファイルとしてもdrawioとしても開けるのか>なぜ画像ファイルとしてもDraw.ioとしても開けるのか</a><ul><li><a href=#drawiopng-or-diopng><code>*.drawio.png</code> or <code>*.dio.png</code></a></li><li><a href=#drawiosvg-or-diosvg><code>*.drawio.svg</code> or <code>*.dio.svg</code></a></li></ul></li><li><a href=#懸念点>懸念点</a><ul><li><a href=#ファイルサイズが大きくなる>ファイルサイズが大きくなる</a></li><li><a href=#複数ページを扱うことはできない>複数ページを扱うことはできない</a></li></ul></li><li><a href=#おわりに>おわりに</a></li></ul></nav><h2 id=vs-code-drawio-integrationの画像エクスポート機能>VS Code Draw.io Integrationの画像エクスポート機能</h2><p>数ヶ月前に、VS CodeのDraw.io Integrationが話題になりました。</p><p><a href=https://qiita.com/riku-shiru/items/5ab7c5aecdfea323ec4e>VSCodeでDraw.ioが使えるようになったらしい！ - Qiita</a></p><p>ただ、上記の記事にもあるようにエクスポート機能は<code>v0.4.0</code>から無効化されており、エクスポート機能を利用するにはオンライン版のDraw.ioに繋がないといけないという本末転倒な状況になっているようです。</p><p>せっかくエディタ内でドキュメントと作図が完結しそうという素敵な体験にあと一歩というところなので、<code>*.drawio</code>ファイルを一括で画像ファイルに変換するスタンドアロンのツールを作ってみたり（<a href=https://github.com/kaakaa/dio-exporter>kaakaa/dio-exporter</a>）もしましたが、もっと良い方法があったようです。</p><h2 id=drawiopng-と-drawiosvg><code>*.drawio.png</code> と <code>*.drawio.svg</code></h2><p><a href=https://blog.anfangd.me/entry/2020/07/08/220628>Visual Studio Code - *.drawio.svg や *.drawio.png の衝撃 - anfangd&rsquo;s blog</a></p><p>こちらの記事で知ったのですが、ファイルを<code>*.drawio.svg</code>や<code>*.drawio.png</code>という拡張子で保存すると、Draw.ioで開くことができ、かつSVG/PNGファイルとして扱うことができるようです。</p><p>公式リポジトリの方にも記述がありました。</p><p><a href=https://github.com/hediet/vscode-drawio#editing-drawiosvgdrawiopng-files>https://github.com/hediet/vscode-drawio#editing-drawiosvgdrawiopng-files</a></p><blockquote><p>You can directly edit and save .drawio.svg and .drawio.png files. These files are perfectly valid svg/png-images that contain an embedded Draw.io diagram. Whenever you edit such a file, the svg/png part of that file is kept up to date.</p></blockquote><p>なぜ、そんなことができるのかを調べてみました。</p><h2 id=なぜ画像ファイルとしてもdrawioとしても開けるのか>なぜ画像ファイルとしてもDraw.ioとしても開けるのか</h2><h3 id=drawiopng-or-diopng><code>*.drawio.png</code> or <code>*.dio.png</code></h3><p>Draw.ioには、<code>extractGraphModelFromPng</code>というメソッドがあり、このメソッドにPNGファイルからDraw.ioのグラフモデルを取得する処理が書かれているようです。</p><p><a href=https://github.com/jgraph/drawio/blob/a579fe9c094510093db631283166f35588848113/src/main/webapp/js/diagramly/Editor.js#L1547>https://github.com/jgraph/drawio/blob/a579fe9c094510093db631283166f35588848113/src/main/webapp/js/diagramly/Editor.js#L1547</a></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>  <span style=color:#a6e22e>Editor</span>.<span style=color:#a6e22e>extractGraphModelFromPng</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>data</span>)
  {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;

        ...  (<span style=color:#a6e22e>snip</span>) ...
      
      <span style=color:#a6e22e>EditorUi</span>.<span style=color:#a6e22e>parsePng</span>(<span style=color:#a6e22e>binary</span>, <span style=color:#a6e22e>mxUtils</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>this</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>type</span>, <span style=color:#a6e22e>length</span>)
      {
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#a6e22e>pos</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span>, <span style=color:#a6e22e>pos</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>length</span>);
        
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;zTXt&#39;</span>)
        {
          <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>idx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>indexOf</span>(String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#ae81ff>0</span>));
          
          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>idx</span>) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;mxGraphModel&#39;</span>)
          {
            <span style=color:#75715e>// Workaround for Java URL Encoder using + for spaces, which isn&#39;t compatible with JS
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>xmlData</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pako</span>.<span style=color:#a6e22e>inflateRaw</span>(<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#a6e22e>idx</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>),
              {<span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;string&#39;</span>}).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/\+/g</span>,<span style=color:#e6db74>&#39; &#39;</span>);
            
            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>xmlData</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>xmlData</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>)
            {
              <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>xmlData</span>;
            }
          }
        }
        <span style=color:#75715e>// Uncompressed section is normally not used
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;tEXt&#39;</span>)
        {
          <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>vals</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>split</span>(String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#ae81ff>0</span>));
          
          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>vals</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>vals</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;mxGraphModel&#39;</span> <span style=color:#f92672>||</span>
            <span style=color:#a6e22e>vals</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;mxfile&#39;</span>))
          {
            <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vals</span>[<span style=color:#ae81ff>1</span>];
          }
        }
        
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;IDAT&#39;</span>)
        {
          <span style=color:#75715e>// Stops processing the file as our text chunks
</span><span style=color:#75715e></span>          <span style=color:#75715e>// are always placed before the data section
</span><span style=color:#75715e></span>          <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
        }
      }));

        ...  (<span style=color:#a6e22e>snip</span>) ...
</code></pre></div><p>PNGファイルの<code>zTXt</code>チャンク、もしくは<code>tEXt</code>チャンクからグラフモデルを読み出しているようです。</p><p>実際に、適当な<code>*.dio.png</code>ファイルを作って中身をみてみます。 以下のコードは <a href=https://qiita.com/kouheiszk/items/17485ccb902e8190923b>PNGを読む - Qiita</a> を参考にしました。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
    <span style=color:#e6db74>&#34;bytes&#34;</span>
    <span style=color:#e6db74>&#34;encoding/binary&#34;</span>
    <span style=color:#e6db74>&#34;fmt&#34;</span>
    <span style=color:#e6db74>&#34;io&#34;</span>
    <span style=color:#e6db74>&#34;net/url&#34;</span>
    <span style=color:#e6db74>&#34;os&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>r</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Reader</span>) (<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
    <span style=color:#a6e22e>buffer</span> <span style=color:#f92672>:=</span> new(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>)
    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>ReadFrom</span>(<span style=color:#a6e22e>r</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
    }
    <span style=color:#66d9ef>if</span> string(<span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#ae81ff>8</span>)) <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;\x89PNG\r\n\x1a\n&#34;</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;not a PNG&#34;</span>)
    }

    <span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>byte</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>32</span>)
    <span style=color:#a6e22e>loop</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>true</span>
    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>loop</span> {
        <span style=color:#a6e22e>length</span> <span style=color:#f92672>:=</span> int(<span style=color:#a6e22e>binary</span>.<span style=color:#a6e22e>BigEndian</span>.<span style=color:#a6e22e>Uint32</span>(<span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#ae81ff>4</span>)))
        <span style=color:#a6e22e>chunkType</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#ae81ff>4</span>))

        <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>chunkType</span> {
        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;zTXt&#34;</span>:
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;chunk: zTXt&#34;</span>)
            <span style=color:#a6e22e>data</span> = append(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#a6e22e>length</span>)<span style=color:#f92672>...</span>)
            <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#ae81ff>4</span>) <span style=color:#75715e>// CRC
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;tEXt&#34;</span>:
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;chunk: tEXt&#34;</span>)
            <span style=color:#a6e22e>data</span> = append(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#a6e22e>length</span>)<span style=color:#f92672>...</span>)
            <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#ae81ff>4</span>) <span style=color:#75715e>// CRC
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;IEND&#34;</span>:
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;chunk: IEND&#34;</span>)
            <span style=color:#a6e22e>loop</span> = <span style=color:#66d9ef>false</span>
        <span style=color:#66d9ef>default</span>:
            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;chunk:&#34;</span>, <span style=color:#a6e22e>chunkType</span>)
            <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#a6e22e>length</span>) <span style=color:#75715e>// chunk data
</span><span style=color:#75715e></span>            <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>buffer</span>.<span style=color:#a6e22e>Next</span>(<span style=color:#ae81ff>4</span>) <span style=color:#75715e>// CRC
</span><span style=color:#75715e></span>        }
    }
    <span style=color:#a6e22e>d</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>QueryUnescape</span>(string(<span style=color:#a6e22e>data</span>))
    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>d</span>)

    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#a6e22e>imageFile</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;test.dio.png&#34;</span>
    <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>imageFile</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }
    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()

    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>file</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
        <span style=color:#66d9ef>return</span>
    }

    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Complete&#34;</span>)
}
</code></pre></div><p>実行結果は下記になります。</p><pre><code>$ go run main.go
chunk: IHDR
chunk: tEXt
chunk: IDAT
chunk: IEND
mxfile&lt;mxfile host=&quot;8ce946a9-c68b-479a-941a-3275fc70c066&quot; modified=&quot;2020-07-28T13:37:16.115Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&quot; version=&quot;13.1.3&quot; etag=&quot;9Ipt2ayCl9tVzXnOHPW3&quot; pages=&quot;2&quot;&gt;&lt;diagram id=&quot;TjNWy2FeEwpBci7nIAZN&quot; name=&quot;ページ1&quot;&gt;&lt;mxGraphModel dx=&quot;630&quot; dy=&quot;380&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;0&quot;/&gt;&lt;mxCell id=&quot;1&quot; parent=&quot;0&quot;/&gt;&lt;mxCell id=&quot;2&quot; value=&quot;TEST&quot; style=&quot;rounded=0;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;1&quot;&gt;&lt;mxGeometry x=&quot;260&quot; y=&quot;170&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;diagram id=&quot;R911WMiv1Lcx-Wbf2GqR&quot; name=&quot;ページ2&quot;&gt;&lt;mxGraphModel dx=&quot;630&quot; dy=&quot;380&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;827&quot; pageHeight=&quot;1169&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&lt;root&gt;&lt;mxCell id=&quot;fRIcQMW-JuJCGEe4Us9i-0&quot;/&gt;&lt;mxCell id=&quot;fRIcQMW-JuJCGEe4Us9i-1&quot; parent=&quot;fRIcQMW-JuJCGEe4Us9i-0&quot;/&gt;&lt;mxCell id=&quot;fRIcQMW-JuJCGEe4Us9i-2&quot; value=&quot;HOGE&quot; style=&quot;ellipse;whiteSpace=wrap;html=1;&quot; vertex=&quot;1&quot; parent=&quot;fRIcQMW-JuJCGEe4Us9i-1&quot;&gt;&lt;mxGeometry x=&quot;260&quot; y=&quot;160&quot; width=&quot;120&quot; height=&quot;80&quot; as=&quot;geometry&quot;/&gt;&lt;/mxCell&gt;&lt;/root&gt;&lt;/mxGraphModel&gt;&lt;/diagram&gt;&lt;/mxfile&gt;
Complete
</code></pre><p>実行結果を見ると、Draw.ioのグラフモデルは <code>zTXt</code>チャンク ではなく <code>tEXt</code>チャンク として保存されているようです。
<code>tEXt</code>チャンクの中身は、XML要素ではない<code>mxfile</code>というワードで始まっていることと、パーセントエンコードされていること以外は、Draw.ioのデータ保存形式と同じように見えます。実際、先頭の<code>mxfile</code>を外したXMLをファイルに保存し、Draw.io Integrationで開いてみたところ問題なく開けました。</p><hr><p>Draw.ioのコード内では、<code>tEXt</code>チャンクは基本的に使われないだろうというコメントが書かれています。</p><pre><code>// Uncompressed section is normally not used
else if (type == 'tEXt')
</code></pre><p>しかし、VS Code Draw.io Integrationで<code>*.drawio.png</code>ファイルを作成した場合は、その<code>tEXt</code>チャンクにデータが保存されています。
個人的な予想ですが、エディタでの操作だと保存回数が多くなるため、保存のたびに圧縮をかける必要のある<code>zTXt</code>チャンクでは保存操作に対するレスポンスが悪くなる恐れがあるため、<code>tEXt</code>チャンクを採用しているのではないかと思っています。</p><h3 id=drawiosvg-or-diosvg><code>*.drawio.svg</code> or <code>*.dio.svg</code></h3><p>SVGファイルの中身はXMLファイルなので、テキストファイルとして開けば <code>&lt;svg></code> タグの <code>content</code>属性の値として、HTMLエンコードされたDraw.ioのグラフモデルが格納されていることがわかります。</p><pre><code>&lt;svg
  xmlns=&quot;http://www.w3.org/2000/svg&quot;
  xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot;
  version=&quot;1.1&quot;
  width=&quot;121px&quot;
  height=&quot;81px&quot;
  viewBox=&quot;-0.5 -0.5 121 81&quot;
  content=&quot;&amp;lt;mxfile host=&amp;quot;40cbe15d-9605-4d22-a796-b079811d4635&amp;quot; modified=&amp;quot;2020-07-28T13:50:29.983Z&amp;quot; agent=&amp;quot;5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Code/1.47.0 Chrome/78.0.3904.130 Electron/7.3.2 Safari/537.36&amp;quot; etag=&amp;quot;dN67jIN7lHvydTadAscc&amp;quot; version=&amp;quot;13.1.3&amp;quot; pages=&amp;quot;2&amp;quot;&amp;gt;&amp;lt;diagram id=&amp;quot;6hGFLwfOUW9BJ-s0fimq&amp;quot; name=&amp;quot;Page-1&amp;quot;&amp;gt;jZJNb8MgDIZ/DfcQtq69Luu2y06ptDMKXkAicUTJkuzXjwyTD1WVdsJ+bIP9YiaKZnxzstMfqMCyPFMjEy8szznPsnDMZIpEnB4iqJ1RlLSC0vwAQaqre6Pgukv0iNabbg8rbFuo/I5J53DYp32h3b/ayRpuQFlJe0s/jfI60mP+tPJ3MLVOL/PDKUYamZJpkquWCocNEmcmCofoo9WMBdhZvKRLrHu9E10ac9D6/xTkseBb2p5mu5zLC/XmpzSww75VMNdkTDwP2ngoO1nN0SF8cWDaNzZ4PJh0JTgP4922+DJs2BLABrybQgoViEfShxaEH8kfVrl50lBvpD4Qk/TD9XL1KkIwSIfkrnr/xTZbK86/&amp;lt;/diagram&amp;gt;&amp;lt;diagram id=&amp;quot;KO23mSEetFSPKnzUMudc&amp;quot; name=&amp;quot;ページ2&amp;quot;&amp;gt;rZNNT4QwEIZ/DcdNKNX9OK4sLhdjIgejt0pnaZNCSbcrsL/eYocv92BMPNF5Zvq2fWcIaFy2R8Nq8aQ5qCAKeRvQQxBFhISh+/Sk84Tu7jwojORYNIFMXgEh7isuksN5UWi1VlbWS5jrqoLcLhgzRjfLspNWy1NrVsANyHKmbumr5FZ4uo02E09BFmI4max3PlOyoRhfchaM62aGaBLQ2Ght/apsY1C9eYMvody/vL1/HNr0tE6S+CpWe7nyYo9/2TI+wUBl/1eaeulPpi7oV/p8TPC9thtMdEquXy54aIS0kNUs7zONGxnHhC2Vi4hbohwYC+0P/3+5PBkddaMIugRrOrcPVeg9NgGnkGwwbqaekqFRYtbPLTKGY1SM0pNVboFuDeHU1O/c7NegyRc=&amp;lt;/diagram&amp;gt;&amp;lt;/mxfile&amp;gt;&quot;
&gt;
    &lt;defs/&gt;
    &lt;g&gt;
        &lt;ellipse cx=&quot;60&quot; cy=&quot;40&quot; rx=&quot;60&quot; ry=&quot;40&quot; fill=&quot;#ffffff&quot; stroke=&quot;#000000&quot; pointer-events=&quot;all&quot;/&gt;
        &lt;g transform=&quot;translate(-0.5 -0.5)&quot;&gt;
            &lt;switch&gt;
      ... (snip) ...

</code></pre><h2 id=懸念点>懸念点</h2><p><code>*.drawio.png</code>、<code>*.drawio.svg</code>形式で保存することで、画像ファイルとしても扱えますし、Draw.ioで開けば追加で編集も加えられるとても便利なファイルを作成することができます。しかし、いくつか懸念すべき点があります。</p><h3 id=ファイルサイズが大きくなる>ファイルサイズが大きくなる</h3><p><code>*.drawio.png</code>や<code>*.drawio.svg</code>は、画像ファイルとしてのデータとDraw.ioとしてのデータの両方を持つことになるため、どうしてもファイルサイズは大きくなってしまいます。また、VS Code Draw.io Integrationで作成すると、Draw.ioのデータは圧縮されずに <code>tEXt</code> チャンクに格納されるため、その点でもファイルサイズを低減できていません。
Webページに使用するなど、容量にシビアな環境では画像ファイルとしてエクスポートし直す必要がありそうです。</p><h3 id=複数ページを扱うことはできない>複数ページを扱うことはできない</h3><p>Draw.ioでは一つのファイルに複数ページ(タブ)を作成することができますが、画像として参照できるのは１ページのみです。（おそらく最初のページ） 複数ページの存在するDraw.ioファイルを画像表示するには、各ページを別ファイルに分割する必要があります。
（<a href=https://github.com/kaakaa/dio-exporter>kaakaa/dio-exporter</a>は複数ページのDraw.ioファイルから複数の画像ファイルを出力できるようになっているはずです）</p><h2 id=おわりに>おわりに</h2><p><code>*.drawio.png</code>や<code>*.drawio.svg</code>というファイル形式にはいくつか懸念事項はありますが、作っているツールの概要をサクッと書きたいときなどは、とても役に立つと思います。</p><p>また、どうやら本体のDraw.io Integrationの方でも、PNGエクスポートの機能は追加される予定のようです。</p><ul><li><a href=https://github.com/hediet/vscode-drawio/issues/56>Support PNG Export · Issue #56 · hediet/vscode-drawio</a></li></ul><blockquote><p>As you can see, this feature has been released to insiders:</p></blockquote><p>執筆時点(2020/07/28)での最新版である <code>v0.7.2</code> では使えませんが、もしかしたらPNGエクスポートの機能は復活するのかもしれません。</p><div class=blog-tags><a href=https://blog.kaakaa.dev/tags/draw.io/>draw.io</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/vs-code/>vs-code</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/png/>png</a>&nbsp;</div></article><div id=disqus_thread></div><script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='kaakaa-blog',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div><a href=https://github.com/kaakaa name=GitHub><em class="fab fa-github-alt fa-lg"></em></a><a href=https://twitter.com/kaakaa_hoe_prog name=Twitter><em class="fab fa-twitter fa-lg"></em></a><a class=social-icon href=https://twitter.com/kaakaa_hoe_prog name=Qiita><img src=https://blog.kaakaa.dev/images/qiita.png width=20 height=20 alt=Qiita></a></div><div class=container><p class="credits copyright"><a href=https://blog.kaakaa.dev/about>Yusuke Nemoto</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://blog.kaakaa.dev/>kaakaa blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>