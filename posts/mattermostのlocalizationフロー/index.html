<!doctype html><html lang=ja-jp><head><meta charset=utf-8><title>MattermostのLocalizationフロー</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-57299975-4"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-57299975-4')</script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://blog.kaakaa.dev/index.xml title="kaakaa blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.kaakaa.dev/images/icon.png"><meta name=twitter:title content="MattermostのLocalizationフロー"><meta name=twitter:description content="社内勉強会用に作成した資料だったものに手を加えて公開。 はじめに Mattermostのローカライズに協力し始めたので、そのフローの記録(201"><meta property="og:title" content="MattermostのLocalizationフロー"><meta property="og:description" content="社内勉強会用に作成した資料だったものに手を加えて公開。 はじめに Mattermostのローカライズに協力し始めたので、そのフローの記録(201"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kaakaa.dev/posts/mattermost%E3%81%AElocalization%E3%83%95%E3%83%AD%E3%83%BC/"><meta property="og:image" content="https://blog.kaakaa.dev/images/icon.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-08-29T18:59:39+09:00"><meta property="article:modified_time" content="2016-08-29T18:59:39+09:00"><link rel=stylesheet href=https://blog.kaakaa.dev/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://blog.kaakaa.dev/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://blog.kaakaa.dev/js/bundle.js></script><script src=https://blog.kaakaa.dev/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.82.0"></head><body><header><nav class=navbar><div class=nav><ul class=nav-links></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>MattermostのLocalizationフロー</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>社内勉強会用に作成した資料だったものに手を加えて公開。</p><h1 id=はじめに>はじめに</h1><p>Mattermostのローカライズに協力し始めたので、そのフローの記録(2016/12月現在)</p><h1 id=mattermost開発参加の背景>Mattermost開発参加の背景</h1><nav id=TableOfContents><ul><li><a href=#チャットツールとの出会い>チャットツールとの出会い</a></li><li><a href=#ローカライズ参加までの流れ>ローカライズ参加までの流れ</a></li></ul><ul><li><a href=#ローカライズ対象>ローカライズ対象</a></li><li><a href=#pootle>Pootle</a><ul><li><a href=#pootleとは>Pootleとは?</a></li></ul></li><li><a href=#ローカライズフロー>ローカライズフロー</a><ul><li><a href=#pootleサーバーでの実際の作業>Pootleサーバーでの実際の作業</a></li><li><a href=#自分で翻訳ファイルを適用する場合>自分で翻訳ファイルを適用する場合</a></li><li><a href=#翻訳する時に気をつけていること>翻訳する時に気をつけていること</a></li></ul></li></ul><ul><li><a href=#成果>成果</a></li><li><a href=#感想>感想</a></li></ul></nav><h2 id=チャットツールとの出会い>チャットツールとの出会い</h2><p>外部の勉強会にはよく参加しており、DevOps/ChatOpsなんかの言葉も認識していました。
少し前のHubotによるChatOpsブームの際に、お試しとして社内のLinuxサーバにKandanを入れたのがChatツールとの出会いです。</p><p>その後、一緒にチャットを使ってくれる方々を巻き込みつつ、Kandanは機能が足りないのでLet&rsquo;s chatへ、Let&rsquo;s Chatの開発滞ってきたところに同期がDockerでMattermost立ててくれたので移行したり。
そんな感じでMattermostを使い始めてからは、機能的に不満もないためバージョンアップを繰り返しながら、そろそろ１年使い続けています。</p><p>最近ようやくSlackを使い始めたのですが、Mattermostに体が慣れすぎて違和感を感じ、プロキシという壁に阻まれた生活を続けたことで身体がガラパゴス化しているのを痛感しています。</p><h2 id=ローカライズ参加までの流れ>ローカライズ参加までの流れ</h2><p>元々、リモートワーク的な開発を経験するために、そこそこ大きなOSSにコントリビュートしてみたいと思っていました。参加するなら、やはり日常的に使うツールの方が良いと思っており、また、MattermostはサーバサイドGo言語・フロントエンドReact.jsと、まさに興味ピンポイントな技術を採用していたため非常に興味を持っていました。</p><p>そんな中、普通にMattermostを使う中で誤翻訳を一つ発見。</p><p>良い機会なので、公式サイトの<a href=https://docs.mattermost.com/developer/localization-process.html>Localizationガイド</a>を見ながら開発チームのチャット（Mattermost）に参加し、翻訳のサジェスションを行ってみました。（翻訳を確定するには権限が必要。権限のないユーザはサジェスションまでしか行えない）
その時、未翻訳だと思われるメッセージが残っていたため、併せて翻訳作業を続けていました。</p><p>そうこうしている内に、新しいバージョンのリリースが近づいたようで翻訳サーバーに翻訳対象メッセージ大量投入されました。が、その当時の公式レビュワーの方が多忙で連絡つかないようで、開発チームのチャットの方でコアメンバーから個別に日本語公式レビュワーにならないかと打診され、本格的に日本語への翻訳を開始することになりました。</p><hr><p><img src=https://qiita-image-store.s3.amazonaws.com/0/9891/4808ed14-a47a-8694-97e5-c68d3bfaac12.png alt=matran8.png></p><ul><li>jason 「他に日本語翻訳してるひといないから公式レビュワーならない？」</li><li>kaakaa 「( ﾟдﾟ )ﾎﾟｶｰﾝ..Okay!!」</li></ul><h1 id=mattermostローカライズの進め方>Mattermostローカライズの進め方</h1><p>ここからは、実際の翻訳作業について記述します。</p><h2 id=ローカライズ対象>ローカライズ対象</h2><p>Mattermostのローカライズ対象メッセージはサーバー/クライアントそれぞれ別ファイルで管理されています。</p><p>サーバーサイドはGo言語で書かれており、<a href=https://github.com/mattermost/platform/blob/master/utils/i18n.go#L14><code>utils.T</code></a>もしくは<a href=https://github.com/mattermost/platform/blob/master/api/context.go#L44><code>Context.T</code></a>を呼び出している部分で言語ごとのメッセージに変換しています。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewServer</span>() {
	<span style=color:#a6e22e>l4g</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>utils</span>.<span style=color:#a6e22e>T</span>(<span style=color:#e6db74>&#34;api.server.new_server.init.info&#34;</span>))

	<span style=color:#a6e22e>Srv</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Server</span>{}
}
</code></pre></div><p><a href=https://github.com/mattermost/platform/blob/master/api/server.go#L40>platform/server.go at master · mattermost/platform</a></p><p>引数のメッセージIDに対応するメッセージはJSON形式で<a href=https://github.com/mattermost/platform/tree/master/i18n><code>i18n/{lang}.json</code></a>に存在します。</p><p><img src=https://qiita-image-store.s3.amazonaws.com/0/9891/c5c5fc24-6a16-4aeb-b0f7-b306de5ab8d8.jpeg alt=localize_server.jpg>
<a href="https://www.youtube.com/watch?v=cVRmzXjpp7Y">Mattermost Developer Brown Bag - Localization - YouTube</a></p><hr><p>クライアントサイドはReact.jsで書かれており、下記関数を使って言語の変換を行っています。</p><ul><li>react-intoの<code>FormattedMessage</code>, <code>FormattedTime</code>, <code>FormattedDate</code></li><li><a href=https://github.com/mattermost/platform/blob/master/webapp/utils/utils.jsx#L1166>loclizeMessage関数</a></li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;FormattedMessage</span>
  <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#39;help.learnMore&#39;</span>
  <span style=color:#a6e22e>defaultMessage=</span><span style=color:#e6db74>&#39;Learn more about:&#39;</span>
<span style=color:#f92672>/&gt;</span>
</code></pre></div><p><a href=https://github.com/mattermost/platform/blob/bb69e98631b2541954b6ae465b8ba5f788b9dc49/webapp/components/help/components/messaging.jsx#L30>platform/messaging.jsx・mattermost/platform</a></p><p>引数のメッセージIDに対応するメッセージは<a href=https://github.com/mattermost/platform/tree/master/webapp/i18n><code>webapp/i18n/{lang}.json</code></a>に存在します。</p><p><img src=https://qiita-image-store.s3.amazonaws.com/0/9891/0bcb6e46-e8c8-0532-1eb0-bcb8ba22d34a.jpeg alt=localize_webapp.jpg>
<a href="https://www.youtube.com/watch?v=cVRmzXjpp7Y">Mattermost Developer Brown Bag - Localization - YouTube</a></p><hr><p>各言語メッセージがかかれている<code>{lang}.json</code>ファイルのうち、実際にPullRequestなどで編集されるのは<code>en.json</code>だけで、その他の言語ファイルについては後述の翻訳サーバーにより生成されます。</p><h2 id=pootle>Pootle</h2><p>ローカライズ作業は<a href=http://pootle.translatehouse.org/>Pootle</a>を利用して行っています。</p><ul><li><a href=http://translate.mattermost.com/>Welcome | Mattermost Translation Server</a></li></ul><p>日本語翻訳についてのコミュニケーションは<a href=https://pre-release.mattermost.com/login title=Mattermost>開発者チャット</a>上の<code>i18n - Japanese</code>や<code>i18n - Localization</code>あたりで行われています。
開発者チャットでは<code>Release Discussion</code>や<code>Developers</code>などの開発上のコミュニケーションなども行われているため、開発に参加する場合はアカウントを作成しておいたほうが良いです。</p><h3 id=pootleとは>Pootleとは?</h3><ul><li><a href=https://ja.wikipedia.org/wiki/Pootle>Pootle - Wikipedia</a><ul><li><code>Pootle は翻訳画面を備えたオンラインの翻訳支援ツールである。ツールは Python で書かれたフリーソフトウェアであり、2004年から Translate.org.za において開発、リリースされている。</code></li><li><code>Pootle はフリーの翻訳支援ソフトウェアからの利用を想定しているが、それに限定されてはいない。また、文書の翻訳よりもソフトウェア・アプリケーションの GUI の国際化を行うことを目的として開発されている。</code></li><li><code>Pootle は、翻訳作業の様々な局面で利用することができる。もっとも単純には、サーバーにある翻訳文の統計データを表示することができる。これにより他のユーザーに修正案を示したり、翻訳を修正してレビューに回したりでき、一種のバグ・レポート管理システムとして使うことができる。また多数の翻訳者に担当を割り当てることができ、さらにオフラインで行われた翻訳をまとめ、翻訳作業全体のワークフローを管理することができる。</code></li><li><code>Pootle は OpenOffice.org[1]、OLPCプロジェクト[2]、その他[3]で利用されている。また Mozilla プロジェクトの翻訳インフラを構築しているVerbatim project でも基盤として採用されている。</code></li></ul></li></ul><h2 id=ローカライズフロー>ローカライズフロー</h2><p>実際の開発で<code>en.json</code>内のメッセージが追加・変更されると、毎日0:00(GMT)に自動でPootleサーバーへ翻訳対象のメッセージの追加が行われます。
また、Pootleサーバー上で翻訳が完了したメッセージは、毎週月曜の22:00(GMT)に本体へPull Requestが作成され、それがマージされることにより翻訳作業が完了します。
<a href=https://github.com/mattermost/platform/pull/4740>translations PR 20161208 by enahum · Pull Request #4740 · mattermost/platform</a></p><p><img src=https://qiita-image-store.s3.amazonaws.com/0/9891/1d31a769-2eb7-8acc-3718-edb3ea8e0da6.png alt=mattermost_translatin.png>
<a href="https://www.youtube.com/watch?v=cVRmzXjpp7Y">Mattermost Developer Brown Bag - Localization - YouTube</a></p><h3 id=pootleサーバーでの実際の作業>Pootleサーバーでの実際の作業</h3><p>全ての言語のローカライズがここで行われている
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/07a4bdf9-48d4-b664-a751-95b4bacade98.png alt=matran1.png></p><hr><p>メッセージはサーバー用とフロントエンド用に分かれている
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/0b2664a4-7aec-850c-cd73-f9dc24ed3ca1.png alt=matran2.png></p><hr><p>翻訳対象メッセージのステータスは<code>Translated(翻訳済み)</code>、<code>Fuzzy(機械翻訳)</code>、<code>Untranslated(未翻訳)</code>に分類される。
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/793d6697-768e-9023-7eb4-01a6362439b6.png alt=matran3.png></p><hr><p><code>Fuzzy(機械翻訳)</code>は、翻訳大将メッセージがサーバに投入されると同時にPootleシステムが自動で翻訳を行ってくれたメッセージ。
レビュワーによる承認作業が必要。
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/f157c264-af82-5266-73d0-56a0e0a56e21.png alt=matran4.png></p><hr><p>翻訳作業は１メッセージごとに行う
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/1d34bd10-65c2-edc8-d770-fdd58138ce7b.png alt=matran5.png></p><hr><p>翻訳を行うとこのように見える。レビュワーがReject(拒否)/Submit(承認)を判断する。
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/2ed9ee6f-dea8-b914-15cb-dc99ac5f2ccc.png alt=matran6.png></p><h3 id=自分で翻訳ファイルを適用する場合>自分で翻訳ファイルを適用する場合</h3><p>翻訳ファイルは毎週masterにマージされ、最新版が含まれた状態でリリースされるため、基本的に自分で動作しているMattermostに最新の翻訳を適用することは無いと思いますが、緊急で特定のメッセージを翻訳しなきゃいけない場合のために。</p><p>Pootleサーバーにて翻訳済みのメッセージはPootle画面からダウンロードできます。
<img src=https://qiita-image-store.s3.amazonaws.com/0/9891/80e311a1-ca41-f732-0a83-3a2e5035ee9d.png alt=matran7.png></p><p>Pootleサーバからダウンロードできるファイルは<code>.po</code>というファイルなのですが、実際のシステムで使用するためには<code>.po</code>ファイルを<code>.json</code>形式に変換する必要があります。
変換には<a href=https://github.com/rodrigocorsi2/mattermosti18n>rodrigocorsi2/mattermosti18n</a>を使用するようです。</p><p>なんとなく、TravisCIで<code>.json</code>ファイルまで生成できるリポジトリ<a href=https://github.com/kaakaa/mattermosti18n/tree/release>kaakaa/mattermosti18n</a>を作ってみましたが、最新の翻訳データを使いたいと思ったことが無いので使っていません。
（英語なら英語のままで良いやと思ってしまう）</p><h3 id=翻訳する時に気をつけていること>翻訳する時に気をつけていること</h3><ul><li>可能な限り既存の訳し方を踏襲する<ul><li>自分の中で言葉が見つかっても、まずは同じ英単語で訳を検索して同じかを確認</li><li>なるべく同じ概念を違う言葉で表現することが無いように（難しい。。。）</li></ul></li><li>ソースコードを検索して、そのメッセージがどこで利用されているかを確認する<ul><li>パッと見た時に訳し方を悩む場合はソースコードを確認して、近くで出現するメッセージを確認する</li><li>設定画面で使われるのか・注意書きとして使われるか&mldr;など</li></ul></li></ul><p>気をつけてはいますが、なかなか統一できないことも多々。。</p><h1 id=ローカライズに参加してみて>ローカライズに参加してみて</h1><h2 id=成果>成果</h2><ul><li><a href=http://www.zazzle.com/knights_of_mattermost_shirt_black-235102741116730031>MattermostのTシャツ</a>もらえた<ul><li>ポロシャツとかパーカーとかいっぱいある（デザイン同じ）<a href="http://www.zazzle.com/pd/styles/pd-235102741116730031?dp=&qs=&tl=">Knights of Mattermost Shirt (Black)</a></li></ul></li><li>公式サイトに名前が載った<ul><li><a href=https://docs.mattermost.com/developer/localization-process.html>Localization — Mattermost documentation</a></li></ul></li><li>Pootle使った翻訳手法を知れた</li><li>チャット上での英語でのコミュニケーションもなんとかなることが分かった（返信に時間かかるけど）</li></ul><h2 id=感想>感想</h2><ul><li>開発プラットフォームが分散してる(Github/JIRA/チャットなど)ので慣れるまでは大変そう<ul><li>コアメンバによるバグfixなどは結構スピーディーなので、コード修正とかに参加するのはちょっと壁がある感</li></ul></li><li>コアメンバはチャットへの返信も早くて親切<ul><li>どんな質問にも答えてくれるけど、英語はやっぱり必要</li></ul></li><li>Mattermostチームは楽しそうに開発してるなーという印象を受けました</li></ul><div class=blog-tags><a href=https://blog.kaakaa.dev/tags/go/>Go</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/golang/>golang</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/localization/>localization</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/mattermost/>Mattermost</a>&nbsp;</div></article><div id=disqus_thread></div><script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='kaakaa-blog',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div class=container><p class="credits copyright"><a href=https://blog.kaakaa.dev/about>Yusuke Nemoto</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://blog.kaakaa.dev/>kaakaa blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>