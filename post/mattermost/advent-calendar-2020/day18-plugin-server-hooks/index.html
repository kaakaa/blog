<!DOCTYPE html>
<html lang="ja-JP">
  <head>
    <meta charset="utf-8" />
<title>[Mattermost Integrations] Plugin (Server hooks)</title>


  
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7H97CTR9R6"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7H97CTR9R6');
  </script>
  




<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link
  rel="alternate"
  type="application/rss+xml"
  href="https://blog.kaakaa.dev/index.xml"
  title="kaakaa blog"
/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Mattermost Integrations] Plugin (Server hooks)"/>
<meta name="twitter:description" content="Mattermostè¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/ æœ¬è¨˜äº‹ã«ã¤ã„ã¦ Mattermostã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ç¬¬18æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚ æœ¬è¨˜äº‹ã§ã¯ã€Mat"/>


  <meta property="og:title" content="[Mattermost Integrations] Plugin (Server hooks)" />
<meta property="og:description" content="Mattermostè¨˜äº‹ã¾ã¨ã‚: https://blog.kaakaa.dev/tags/mattermost/ æœ¬è¨˜äº‹ã«ã¤ã„ã¦ Mattermostã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ç¬¬18æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚ æœ¬è¨˜äº‹ã§ã¯ã€Mat" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.kaakaa.dev/post/mattermost/advent-calendar-2020/day18-plugin-server-hooks/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-12-18T00:00:00&#43;09:00" />
<meta property="article:modified_time" content="2020-12-18T00:00:00&#43;09:00" />




<link rel="stylesheet" href="https://blog.kaakaa.dev/fontawesome/css/all.min.css" />

<link
  id="dark-mode-theme"
  rel="stylesheet"
  href="https://blog.kaakaa.dev/css/dark.css"
/>

<script>
  var darkTheme = document.getElementById('dark-mode-theme')
  var storedTheme = localStorage.getItem('dark-mode-storage')
  if (storedTheme === 'dark') {
    darkTheme.disabled = false
  } else if (storedTheme === 'light') {
    darkTheme.disabled = true
  }
</script>

<script src="https://blog.kaakaa.dev/js/main.bundle.js"></script>
<script src="https://blog.kaakaa.dev/js/instantpage.min.js" type="module" defer></script>
<meta name="generator" content="Hugo 0.82.0" />
  </head>
  <body>
    
  




  <header>
    <nav class="navbar">
  <div class="nav">
    
      <a href="https://blog.kaakaa.dev/" class="nav-logo">
        <img
          src="https://blog.kaakaa.dev/images/icon.png"
          width="50"
          height="50"
          alt="Logo"
        />
      </a>
    

    <ul class="nav-links">
      
        
          <li>
            <a href="/" id="Home"
              ><em class="fas fa-home fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/about/" id="About"
              ><em class="fas fa-user fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/tags/" id="Tags"
              ><em class="fas fa-tag fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/search/" id="Search"
              ><em class="fas fa-search fa-lg"></em
            ></a>
          </li>
          
      
        
          <li>
            <a href="/index.xml" id="Subscribe"
              ><em class="fas fa-rss fa-lg"></em
            ></a>
          </li>
          
      
    </ul>
  </div>
</nav>

    <div class="intro-header">
      <div class="container">
        <div class="post-heading">
          
            <h1>
              [Mattermost Integrations] Plugin (Server hooks)
            </h1>
          
          
            <span class="meta-post">
  <em class="fa fa-calendar-alt"></em
  >&nbsp;Dec 18, 2020
  
</span>

          
        </div>
      </div>
    </div>
  </header>
  

    
  <div class="container" role="main">
    <article class="article" class="blog-post">
      <p>Mattermostè¨˜äº‹ã¾ã¨ã‚: <a href="https://blog.kaakaa.dev/tags/mattermost/">https://blog.kaakaa.dev/tags/mattermost/</a></p>
<nav id="TableOfContents">
  <ul>
    <li><a href="#æœ¬è¨˜äº‹ã«ã¤ã„ã¦">æœ¬è¨˜äº‹ã«ã¤ã„ã¦</a></li>
    <li><a href="#mattermost-plugin-server-ã«ã¤ã„ã¦">Mattermost Plugin (Server) ã«ã¤ã„ã¦</a></li>
    <li><a href="#server-hooks">Server Hooks</a>
      <ul>
        <li><a href="#onactivate">OnActivate</a></li>
        <li><a href="#implemented">Implemented</a></li>
        <li><a href="#ondeactivate">OnDeactivate</a></li>
        <li><a href="#onconfigurationchange">OnConfigurationChange</a></li>
        <li><a href="#servehttp">ServeHTTP</a></li>
        <li><a href="#executecommand">ExecuteCommand</a></li>
        <li><a href="#userhasbeencreated">UserHasBeenCreated</a></li>
        <li><a href="#userwilllogin">UserWillLogIn</a></li>
        <li><a href="#userhasloggedin">UserHasLoggedIn</a></li>
        <li><a href="#messagewillbeposted">MessageWillBePosted</a></li>
        <li><a href="#messagewillbeupdated">MessageWillBeUpdated</a></li>
        <li><a href="#messagehasbeenposted">MessageHasBeenPosted</a></li>
        <li><a href="#messagehasbeedupdated">MessageHasBeedUpdated</a></li>
        <li><a href="#channelhasbeencreated">ChannelHasBeenCreated</a></li>
        <li><a href="#userhasjoinedchannel">UserHasJoinedChannel</a></li>
        <li><a href="#userhasleftchannel">UserHasLeftChannel</a></li>
        <li><a href="#userhasjoinedteam">UserHasJoinedTeam</a></li>
        <li><a href="#userhasleftteam">UserHasLeftTeam</a></li>
        <li><a href="#filewillbeuploaded">FileWillBeUploaded</a></li>
      </ul>
    </li>
    <li><a href="#ã•ã„ã”ã«">ã•ã„ã”ã«</a></li>
  </ul>
</nav><h2 id="æœ¬è¨˜äº‹ã«ã¤ã„ã¦">æœ¬è¨˜äº‹ã«ã¤ã„ã¦</h2>
<p><a href="https://qiita.com/advent-calendar/2020/mattermost-integrations">Mattermostã®çµ±åˆæ©Ÿèƒ½ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>ã®ç¬¬18æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>
<p>æœ¬è¨˜äº‹ã§ã¯ã€Mattermostä¸Šã®æ§˜ã€…ãªæ“ä½œã«å¯¾å¿œã—ãŸå‡¦ç†ã‚’è¿½åŠ ã§ãã‚‹Mattermost Pluginã®<strong>Server</strong>ã‚µã‚¤ãƒ‰ã®æ©Ÿèƒ½ã§ã‚ã‚‹<strong>Server Hooks</strong>ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p>
<p>Mattermost Pluginã«ã¤ã„ã¦ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ä¸‹è¨˜ã«ãªã‚Šã¾ã™ã€‚
<a href="https://developers.mattermost.com/extend/plugins/overview/">https://developers.mattermost.com/extend/plugins/overview/</a></p>
<h2 id="mattermost-plugin-server-ã«ã¤ã„ã¦">Mattermost Plugin (Server) ã«ã¤ã„ã¦</h2>
<p><strong>Server Hooks</strong>ã®èª¬æ˜ã®å‰ã«ã€Mattermost Pluginã®æœ¬ä½“ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p>
<p>Mattermostã®<strong>Server</strong>ã‚µã‚¤ãƒ‰ã®Pluginã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€<a href="https://github.com/mattermost/mattermost-server/blob/f2571099539ee6e432d59e5bb4bc390652426a0e/plugin/client.go#L39"><code>plugin.MattermostPlugin</code></a>ã‚’åŸ‹ã‚è¾¼ã‚“ã æ§‹é€ ä½“ãŒPluginæœ¬ä½“ã¨ãªã‚Šã¾ã™ã€‚<code>plugin.MattermostPlugin</code>ã‚’åŸ‹ã‚è¾¼ã‚“ã æ§‹é€ ä½“ã¯ã€<code>API</code>ã¨<code>Helper</code>ã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¡ã€ã“ã‚Œã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’çµŒç”±ã—ã¦Mattermostã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‡¦ç†ã™ã‚‹æ§˜ã€…ãªãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€<code>plugin.MattermostPlugin</code>ã‚’åŸ‹ã‚è¾¼ã‚“ã æ§‹é€ ä½“ã«å¯¾ã—ã¦<strong>Server Hooks</strong>ã¨åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æŒã¤ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€<strong>Server Hooks</strong>ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/mattermost/mattermost-server/v5/plugin&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SamplePlugin</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">MattermostPlugin</span>
}

<span style="color:#75715e">// OnActivate Hooksã®å®Ÿè£…
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">OnActivate</span>() <span style="color:#66d9ef">error</span> {
    <span style="color:#75715e">// `API`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é€šã˜ãŸPlugin APIã®å‘¼ã³å‡ºã—
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">RegisterCommand</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Command</span>{
		<span style="color:#a6e22e">Trigger</span>: <span style="color:#e6db74">&#34;sample-command&#34;</span>,
	}); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Wrap</span>(<span style="color:#a6e22e">err</span>, <span style="color:#e6db74">&#34;failed to register  command&#34;</span>)
	}
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p><code>main</code>ãƒ¡ã‚½ãƒƒãƒ‰ã§<code>plugin.MattermostPlugin</code>ã‚’åŸ‹ã‚è¾¼ã‚“ã æ§‹é€ ä½“ã‚’å¼•æ•°ã¨ã—ã¦<code>plugin.ClientMain</code>ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶ã“ã¨ã§ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;github.com/mattermost/mattermost-server/v5/plugin&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">ClientMain</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">SamplePlugin</span>{})
}
</code></pre></div><h2 id="server-hooks">Server Hooks</h2>
<p>Mattermost Pluginã®Server Hooksã¯ã€Mattermostä¸Šã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒ³ãƒãƒ«ã«å‚åŠ ã—ãŸã¨ãã‚„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒMattermostã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã¨ããªã©ã€ä½•ã‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã‚’è¿½åŠ ã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚
<code>plugin.MattermostPlugin</code>ã‚’åŸ‹ã‚è¾¼ã‚“ã æ§‹é€ ä½“ã«ã€Server Hooksã¨åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æŒã¤ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§åˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
<p>Server Hooksã®ä¸€è¦§ã¯ä¸‹è¨˜ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚</p>
<p><a href="https://developers.mattermost.com/extend/plugins/server/reference/#Hooks">https://developers.mattermost.com/extend/plugins/server/reference/#Hooks</a></p>
<h3 id="onactivate">OnActivate</h3>
<p><code>OnActivate</code>ã¯PluginãŒèµ·å‹•ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹Hookã§ã™ã€‚Botã‚’ä½¿ã†Pluginã®å ´åˆã¯ã“ã®Hookå†…ã§Botãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ãŸã‚Šã€Slash Commandã‚’ä½¿ã†Pluginãªã‚‰SlashCommandã®ç™»éŒ²ãªã©ã‚’è¡Œã„ã¾ã™ã€‚(Pluginã‹ã‚‰ç™»éŒ²ã—ãŸSlash Commandã¯ã€é€šå¸¸ã®çµ±åˆæ©Ÿèƒ½ã¨ã—ã¦ä½œæˆã—ãŸSlash Commandã¨é•ã„å¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚Slash CommandãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ã®å‡¦ç†ã¯ã€Server Hooksã®<code>ExecuteCommand</code>ã§å®Ÿè£…ã—ã¾ã™ã€‚)</p>
<p>`error``ãŒè¿”å´ã•ã‚ŒãŸå ´åˆã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒèµ·å‹•ã•ã‚Œã¾ã›ã‚“ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">OnActivate</span>() <span style="color:#66d9ef">error</span> {
	<span style="color:#75715e">// Botã®ç™»éŒ²
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">bot</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Bot</span>{
		<span style="color:#a6e22e">Username</span>:    <span style="color:#e6db74">&#34;test-bot&#34;</span>,
		<span style="color:#a6e22e">DisplayName</span>: <span style="color:#e6db74">&#34;Sample Bot&#34;</span>,
	}
	<span style="color:#a6e22e">botUserID</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Helpers</span>.<span style="color:#a6e22e">EnsureBot</span>(<span style="color:#a6e22e">bot</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Wrap</span>(<span style="color:#a6e22e">appErr</span>, <span style="color:#e6db74">&#34;failed to ensure bot user&#34;</span>)
	}
	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span> = <span style="color:#a6e22e">botUserID</span>

	<span style="color:#75715e">// Slash Commandã®ç™»éŒ²
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">RegisterCommand</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Command</span>{
		<span style="color:#a6e22e">Trigger</span>:      <span style="color:#e6db74">&#34;sample&#34;</span>,
		<span style="color:#a6e22e">AutoComplete</span>: <span style="color:#66d9ef">true</span>,
	}); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Wrap</span>(<span style="color:#a6e22e">err</span>, <span style="color:#e6db74">&#34;failed to register  command&#34;</span>)
	}

    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}
</code></pre></div><h3 id="implemented">Implemented</h3>
<p><code>Implemented</code>ã¯ã€PluginãŒå®Ÿè£…ã—ã¦ã„ã‚‹Hookã®åå‰ã‚’è¿”ã™ãŸã‚ã®Hooksã§ã™ã€‚ã—ã‹ã—ã€å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã‚’è¦‹ãŸã“ã¨ãŒãªã„ã®ã§ã€ç”¨é€”ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MatterpollPlugin</span>) <span style="color:#a6e22e">Implemented</span>() ([]<span style="color:#66d9ef">string</span>, <span style="color:#66d9ef">error</span>) {
    <span style="color:#66d9ef">return</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;OnActivate&#34;</span>, <span style="color:#e6db74">&#34;Implemented&#34;</span>}, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><h3 id="ondeactivate">OnDeactivate</h3>
<p><code>OnDeactivate</code>ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒåœæ­¢ã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">MatterpollPlugin</span>) <span style="color:#a6e22e">OnDeactivate</span>() <span style="color:#66d9ef">error</span> {
    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">clean</span>()
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}
</code></pre></div><h3 id="onconfigurationchange">OnConfigurationChange</h3>
<p>Pluginå°‚ç”¨ã®è¨­å®šãŒå¤‰æ›´ã•ã‚ŒãŸéš›ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
Mattermost Pluginã®<a href="https://developers.mattermost.com/extend/plugins/manifest-reference/">Manifestãƒ•ã‚¡ã‚¤ãƒ«</a>ã«<code>settings</code>ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ã§ã€Pluginå°‚ç”¨ã®è¨­å®šç”»é¢ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/configuration-page.png" alt="IMAGE"></p>
<p><code>OnConfigurationChange</code>å‘¨ã‚Šã®å‡¦ç†ã¯ä¸‹è¨˜ã®Starterãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚³ãƒ¼ãƒ‰ã‚’æµç”¨ã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚
<a href="https://github.com/mattermost/mattermost-plugin-starter-template/blob/master/server/configuration.go">https://github.com/mattermost/mattermost-plugin-starter-template/blob/master/server/configuration.go</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">configuration</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">SampleSetting</span> <span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">OnConfigurationChange</span>() <span style="color:#66d9ef">error</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">configuration</span> = new(<span style="color:#a6e22e">configuration</span>)

	<span style="color:#75715e">// Load the public configuration fields from the Mattermost server configuration.
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LoadPluginConfiguration</span>(<span style="color:#a6e22e">configuration</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Wrap</span>(<span style="color:#a6e22e">err</span>, <span style="color:#e6db74">&#34;failed to load plugin configuration&#34;</span>)
	}

    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">setConfiguration</span>(<span style="color:#a6e22e">configuration</span>)
    
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}
</code></pre></div><h3 id="servehttp">ServeHTTP</h3>
<p>Mattermost Pluginå°‚ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
<p>Mattermost Pluginã«ã¯Pluginã”ã¨ã«ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå­˜åœ¨ã—ã¾ã™ã€‚MattermostãŒ<code>https://example.com:8065</code>ã§èµ·å‹•ã—ã¦ã„ãŸã¨ã™ã‚‹ã¨ã€<code>https://example.com:8065/plugins/{PLUGING_ID}</code>ãŒPluginå°‚ç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚ã“ã“ã«é€ã‚‰ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ã®ãŒ<code>ServeHTTP</code>ã§ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">ServeHTTP</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprint</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;Hello, world!&#34;</span>)
}
</code></pre></div><p><a href="https://docs.mattermost.com/developer/interactive-messages.html">Interactive Message</a>ãªã©ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡å…ˆã‚’Pluginç”¨ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã™ã‚‹ãªã©ã®åˆ©ç”¨æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚</p>
<h3 id="executecommand">ExecuteCommand</h3>
<p>Plugin APIã®<a href="https://developers.mattermost.com/extend/plugins/server/reference/#API.RegisterCommand"><code>RegisterCommand</code></a>ã§ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚ŒãŸæ™‚ã«å‡¦ç†ã•ã‚Œã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">OnActivate</span>() <span style="color:#66d9ef">error</span> {
	<span style="color:#75715e">// Slash Commandã®ç™»éŒ²
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">RegisterCommand</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Command</span>{
		<span style="color:#a6e22e">Trigger</span>:      <span style="color:#e6db74">&#34;sample&#34;</span>,
		<span style="color:#a6e22e">AutoComplete</span>: <span style="color:#66d9ef">true</span>,
	}); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Wrap</span>(<span style="color:#a6e22e">err</span>, <span style="color:#e6db74">&#34;failed to register  command&#34;</span>)
	}

	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">ExecuteCommand</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">CommandArgs</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">CommandResponse</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">AppError</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">CommandResponse</span>{<span style="color:#a6e22e">Text</span>: <span style="color:#e6db74">&#34;Hello by plugin&#34;</span>}, <span style="color:#66d9ef">nil</span>
}
</code></pre></div><h3 id="userhasbeencreated">UserHasBeenCreated</h3>
<p><code>UserHasBeenCreated</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–°è¦ã«ä½œæˆã•ã‚ŒãŸå ´åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
æ–°ã—ãå‚åŠ ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«Botã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹å ´åˆãªã©ã«ä½¿ç”¨ã§ãã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/user-has-been-created.png" alt="IMAGE"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserHasBeenCreated</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">user</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>) {
	<span style="color:#a6e22e">channel</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">GetDirectChannel</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>, <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogWarn</span>(<span style="color:#e6db74">&#34;failed to get direct channel&#34;</span>, <span style="color:#e6db74">&#34;user_id1&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>, <span style="color:#e6db74">&#34;user_id2&#34;</span>, <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">CreatePost</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>{
		<span style="color:#a6e22e">ChannelId</span>: <span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">Id</span>,
		<span style="color:#a6e22e">UserId</span>:    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>,
		<span style="color:#a6e22e">Message</span>:   <span style="color:#e6db74">&#34;Welcome to Our Mattermost!&#34;</span>,
	}); <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogWarn</span>(<span style="color:#e6db74">&#34;failed to create welcome post.&#34;</span>, <span style="color:#e6db74">&#34;channel_id&#34;</span>, <span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>.<span style="color:#a6e22e">Error</span>())
	}
}
</code></pre></div><h3 id="userwilllogin">UserWillLogIn</h3>
<p><code>UserWillLogIn</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
<p>ç©ºæ–‡å­—ä»¥å¤–ã®æ–‡å­—åˆ—ã‚’è¿”ã™ã¨ãƒ­ã‚°ã‚¤ãƒ³ãŒå–ã‚Šæ¶ˆã•ã‚Œã¾ã™ãŒã€ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯è¿”å´ã—ãŸæ–‡å­—åˆ—ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¡¨ç¤ºã•ã‚Œãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒåˆã£ã¦ã„ã¦ã‚‚<code>Enter a valid email or username and/or password</code>ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã†ã‚ˆã†ã§ã™ã€‚ã•ã‚‰ã«ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç®¡ç†ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã—ã¾ã†ã¨ã€å‰è¨˜ã®ã‚¨ãƒ©ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ããšã€åˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹ã«æˆ»ã™ã®ãŒå›°é›£ã«ãªã£ã¦ã—ã¾ã†ã‹ã‚‚ã—ã‚Œãªã„ãŸã‚ã€ä½¿ç”¨ã«ã¯æ³¨æ„ãŒå¿…è¦ãã†ã§ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">unc</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserWillLogIn</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">user</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>) <span style="color:#66d9ef">string</span> {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">check</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()
	}
	<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>
}
</code></pre></div><h3 id="userhasloggedin">UserHasLoggedIn</h3>
<p><code>UserHasLoggedIn</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
<p>å‰å›ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ(ã‚ªãƒ•ãƒ©ã‚¤ãƒ³)ã—ã¦ã‹ã‚‰ã€7æ—¥ä»¥ä¸ŠçµŒéã—ã¦ã„ãŸå ´åˆã«Botã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹å ´åˆãªã©ã«åˆ©ç”¨ã§ãã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/user-has-logged-in.png" alt="IMAGE"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserHasLoggedIn</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">user</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>) {
	<span style="color:#a6e22e">status</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">GetUserStatus</span>(<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogWarn</span>(<span style="color:#e6db74">&#34;failed to get user status&#34;</span>, <span style="color:#e6db74">&#34;user_id&#34;</span>, <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>.<span style="color:#a6e22e">Error</span>())
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Unix</span>(<span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">LastActivityAt</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1000</span>, <span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">LastActivityAt</span><span style="color:#f92672">%</span><span style="color:#ae81ff">1000</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">status</span>.<span style="color:#a6e22e">Status</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">STATUS_OFFLINE</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">After</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">AddDate</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">7</span>)) {
		<span style="color:#a6e22e">channel</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">GetDirectChannel</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>, <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogWarn</span>(<span style="color:#e6db74">&#34;failed to get direct channel&#34;</span>, <span style="color:#e6db74">&#34;user_id1&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>, <span style="color:#e6db74">&#34;user_id2&#34;</span>, <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>.<span style="color:#a6e22e">Error</span>())
			<span style="color:#66d9ef">return</span>
		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">CreatePost</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>{
			<span style="color:#a6e22e">ChannelId</span>: <span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">Id</span>,
			<span style="color:#a6e22e">UserId</span>:    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>,
			<span style="color:#a6e22e">Message</span>:   <span style="color:#e6db74">&#34;Hi! :wave:&#34;</span>,
		}); <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogWarn</span>(<span style="color:#e6db74">&#34;failed to create post.&#34;</span>, <span style="color:#e6db74">&#34;channel_id&#34;</span>, <span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>.<span style="color:#a6e22e">Error</span>())
		}
	}
}
</code></pre></div><h3 id="messagewillbeposted">MessageWillBePosted</h3>
<p><code>MessageWillBePosted</code>ã¯ã€æŠ•ç¨¿ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã‚‹å‰ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚æŠ•ç¨¿ã‚’æ‹’å¦ã—ãŸã‚Šã€æŠ•ç¨¿å†…å®¹ã‚’è‡ªå‹•ã§ç·¨é›†ã—ãŸã„å ´åˆãªã©ã«åˆ©ç”¨ã§ãã¾ã™ã€‚æŠ•ç¨¿ä½œæˆæ™‚ã«æ‹’å¦ã‚„ç·¨é›†ä»¥å¤–ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€æŠ•ç¨¿ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚ŒãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹<code>MessageHasBeenPosted</code>ã®åˆ©ç”¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<p>æŠ•ç¨¿ã‚’æ‹’å¦ã™ã‚‹å ´åˆã¯ã€ï¼’ã¤ç›®ã®returnå€¤ã«ç©ºã§ãªã„æ–‡å­—åˆ—ã‚’æŒ‡å®šã—ã¾ã™ã€‚ä¸€ã¤ç›®ã®è¿”å´å€¤ã®<code>*model.Post</code>ã«ã¯å†…å®¹ã‚’ç·¨é›†ã—ãŸå¾Œã®<code>*model.Post</code>ã‚’æŒ‡å®šã—ã¾ã™ã€‚<code>nil</code>ã‚’æŒ‡å®šã—ãŸå ´åˆã§ã‚‚ã€å¼•æ•°ã§ä¸ãˆã‚‰ã‚ŒãŸ<code>*model.Post</code>ãŒæŒ‡å®šã•ã‚ŒãŸã‚‚ã®ã¨è§£é‡ˆã•ã‚Œã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">MessageWillBePosted</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">post</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>, <span style="color:#66d9ef">string</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">post</span>.<span style="color:#a6e22e">Message</span>, <span style="color:#e6db74">&#34;shit&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">post</span>.<span style="color:#a6e22e">Message</span>, <span style="color:#e6db74">&#34;ğŸ’©&#34;</span>) {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#e6db74">&#34;You can&#39;t use `shit` and ğŸ’© on this server.&#34;</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#e6db74">&#34;&#34;</span>
}
</code></pre></div><p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/message-will-be-posted.png" alt="IMAGE"></p>
<p>ã“ã®Hookã«ã‚ˆã£ã¦æŠ•ç¨¿ãŒæ‹’å¦ã•ã‚ŒãŸå ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã¯ãã®æ‹’å¦ç†ç”±ãŒè¦‹ãˆãªã„ã‚ˆã†ãªã®ã§ã€æ‹’å¦åŸºæº–ã‚’æ˜æ–‡åŒ–ã—ãŸã‚Šã€æ‹’å¦ç†ç”±ã‚’Botã‹ã‚‰é€šçŸ¥ã™ã‚‹ãªã©ã®å¯¾å¿œãŒå¿…è¦ãã†ã§ã™ã€‚</p>
<h3 id="messagewillbeupdated">MessageWillBeUpdated</h3>
<p><code>MessageWillBeUpdated</code>ã¯ã€æŠ•ç¨¿æ¸ˆã¿ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç·¨é›†ã—ãŸéš›ã€ç·¨é›†å†…å®¹ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚Œã‚‹ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã§ã™ã€‚
<code>MessageWillBePosted</code>ã¨ã»ã¼åŒã˜å†…å®¹ã®ãŸã‚ã€ä¾‹ã¯çœç•¥ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">MessageWillBeUpdated</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">newPost</span>, <span style="color:#a6e22e">oldPost</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>, <span style="color:#66d9ef">string</span>) {
    <span style="color:#f92672">...</span>
} 
</code></pre></div><h3 id="messagehasbeenposted">MessageHasBeenPosted</h3>
<p><code>MessageHasBeenPosted</code>ã¯ã€æŠ•ç¨¿ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚ŒãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã§ã™ã€‚</p>
<p>ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä½œæˆã•ã‚ŒãŸå ´åˆã«ã€ç‰¹å®šã®ãƒãƒ£ãƒ³ãƒãƒ«ã«é€šçŸ¥ã™ã‚‹ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
BotãŒä½œæˆã—ãŸæŠ•ç¨¿ã‚‚ã“ã®Hookã§å‡¦ç†ã•ã‚Œã‚‹ãŸã‚ã€è€ƒæ…®ãŒæ¼ã‚Œã‚‹ã¨å‡¦ç†ãŒç„¡é™ãƒ«ãƒ¼ãƒ—ã—ã¦ã—ã¾ã†ãŸã‚æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚ã¾ãŸã€éå…¬é–‹ãƒãƒ£ãƒ³ãƒãƒ«ã®æŠ•ç¨¿ãªã©ã‚‚å‡¦ç†ã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€ãã®ç‚¹ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ã‚‚ã‚ã‚Šã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/message-has-been-posted.png" alt="IMAGE"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">MessageHasBeenPosted</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">post</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>) {
	<span style="color:#a6e22e">postUrl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;http://localhost:8065/_redirect/pl/%s&#34;</span>, <span style="color:#a6e22e">post</span>.<span style="color:#a6e22e">Id</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Contains</span>(<span style="color:#a6e22e">post</span>.<span style="color:#a6e22e">Message</span>, <span style="color:#e6db74">&#34;mattermost&#34;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">post</span>.<span style="color:#a6e22e">UserId</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">CreatePost</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>{
			<span style="color:#a6e22e">Message</span>:   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Post refered to `mattermost` is created. See [here](%s) &#34;</span>, <span style="color:#a6e22e">postUrl</span>),
			<span style="color:#a6e22e">UserId</span>:    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>,
			<span style="color:#a6e22e">ChannelId</span>: <span style="color:#e6db74">&#34;su7w9z51atnspjufg1c73ijx8w&#34;</span>,
		})
	}
}
</code></pre></div><h3 id="messagehasbeedupdated">MessageHasBeedUpdated</h3>
<p><code>MessageHasBeenUpdated</code>ã¯ã€æŠ•ç¨¿æ¸ˆã¿ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç·¨é›†ã—ãŸéš›ã€ç·¨é›†å†…å®¹ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã•ã‚ŒãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã§ã™ã€‚
ã“ã¡ã‚‰ã‚‚<code>MessageHasBeenPosted</code>ã¨ã»ã¼åŒã˜å†…å®¹ã®ãŸã‚ã€ä¾‹ã¯çœç•¥ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">MessageHasBeenUpdated</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">newPost</span>, <span style="color:#a6e22e">oldPost</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>) {
    <span style="color:#f92672">...</span>
}
</code></pre></div><h3 id="channelhasbeencreated">ChannelHasBeenCreated</h3>
<p><code>ChannelHasBeenCreated</code>ã¯ã€ãƒãƒ£ãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚ŒãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
<p>ãƒãƒ£ãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚ŒãŸã“ã¨ã‚’<code>town-square</code>ãƒãƒ£ãƒ³ãƒãƒ«ã«é€šçŸ¥ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã®Hookã«ã¤ã„ã¦ã‚‚ã€éå…¬é–‹ãƒãƒ£ãƒ³ãƒãƒ«ãŒä½œæˆã•ã‚ŒãŸå ´åˆã®è€ƒæ…®ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/channel-has-been-created.png" alt="IMAGE"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">ChannelHasBeenCreated</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">channel</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Channel</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">Type</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">CHANNEL_OPEN</span> {
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#a6e22e">u</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">GetUser</span>(<span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">CreatorId</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogError</span>(<span style="color:#e6db74">&#34;Failed to get user&#34;</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">townSquare</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">GetChannelByName</span>(<span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">TeamId</span>, <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">DEFAULT_CHANNEL</span>, <span style="color:#66d9ef">false</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogError</span>(<span style="color:#e6db74">&#34;Failed to get channel&#34;</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">CreatePost</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>{
		<span style="color:#a6e22e">Type</span>:      <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">POST_DEFAULT</span>,
		<span style="color:#a6e22e">ChannelId</span>: <span style="color:#a6e22e">townSquare</span>.<span style="color:#a6e22e">Id</span>,
		<span style="color:#a6e22e">UserId</span>:    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>,
		<span style="color:#a6e22e">Message</span>:   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Channel ~%s has been created by %s.&#34;</span>, <span style="color:#a6e22e">channel</span>.<span style="color:#a6e22e">Name</span>, <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">GetDisplayName</span>(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">SHOW_USERNAME</span>)),
	}); <span style="color:#a6e22e">appErr</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogError</span>(<span style="color:#e6db74">&#34;Failed to create post&#34;</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">appErr</span>)
	}
}
</code></pre></div><h3 id="userhasjoinedchannel">UserHasJoinedChannel</h3>
<p><code>UserHasJoinedChannel</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒ³ãƒãƒ«ã«å‚åŠ ã—ãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ç¬¬ï¼“å¼•æ•°ã®<code>actor</code>ã¯ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒãƒ£ãƒ³ãƒãƒ«ã«è¿½åŠ ã—ãŸå ´åˆãªã©ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒãƒ£ãƒ³ãƒãƒ«ã«è¿½åŠ ã™ã‚‹å‡¦ç†ã‚’å®Ÿè¡Œã—ãŸäººã®æƒ…å ±ãŒå…¥ã‚Šã¾ã™ã€‚</p>
<p>ãƒãƒ£ãƒ³ãƒãƒ«ã«æ–°ã—ãå‚åŠ ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«èª­ã‚“ã§æ¬²ã—ã„ãƒªãƒ³ã‚¯ãªã©ã‚’é€šçŸ¥ã™ã‚‹å ´åˆã«åˆ©ç”¨ã§ãã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/user-has-joined-channel.png" alt="IMAGE"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserHasJoinedChannel</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">channelMember</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">ChannelMember</span>, <span style="color:#a6e22e">actor</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">channelMember</span>.<span style="color:#a6e22e">ChannelId</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">TargetChannelID</span> {
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">SendEphemeralPost</span>(<span style="color:#a6e22e">actor</span>.<span style="color:#a6e22e">Id</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">Post</span>{
		<span style="color:#a6e22e">ChannelId</span>: <span style="color:#a6e22e">channelMember</span>.<span style="color:#a6e22e">ChannelId</span>,
		<span style="color:#a6e22e">UserId</span>:    <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">botUserID</span>,
		<span style="color:#a6e22e">Message</span>:   <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;This chanels is for XXX user. You&#39;d better to read [notes for this channel](%s).&#34;</span>, <span style="color:#a6e22e">UrlForNotes</span>),
	})
}
</code></pre></div><h3 id="userhasleftchannel">UserHasLeftChannel</h3>
<p><code>UserHasLeftChannel</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰è„±é€€ã—ãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
<code>UserHasJoinedChannel</code>ã¨ã»ã¼åŒã˜å†…å®¹ã®ãŸã‚ã€ä¾‹ã¯çœç•¥ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserHasLeftChannel</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">channelMember</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">ChannelMember</span>, <span style="color:#a6e22e">actor</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>) {
    <span style="color:#f92672">...</span>
}
</code></pre></div><h3 id="userhasjoinedteam">UserHasJoinedTeam</h3>
<p><code>UserHasJoinedTeam</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ¼ãƒ ã«å‚åŠ ã—ãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
<code>UserHasJoinedChannel</code>ã¨ã»ã¼åŒã˜å†…å®¹ã®ãŸã‚ã€ä¾‹ã¯çœç•¥ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserHasJoinedTeam</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">teamMember</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">TeamMember</span>, <span style="color:#a6e22e">actor</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>)  {
    <span style="color:#f92672">...</span>
}
</code></pre></div><h3 id="userhasleftteam">UserHasLeftTeam</h3>
<p><code>UserHasLeftTeam</code>ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰è„±é€€ã—ãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
<code>UserHasJoinedChannel</code>ã¨ã»ã¼åŒã˜å†…å®¹ã®ãŸã‚ã€ä¾‹ã¯çœç•¥ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">UserHasLeftTeam</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">teamMember</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">TeamMember</span>, <span style="color:#a6e22e">actor</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">User</span>) {
    <span style="color:#f92672">...</span>
}
</code></pre></div><h3 id="filewillbeuploaded">FileWillBeUploaded</h3>
<p><code>FileWillBeUploaded</code>ã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ·»ä»˜ã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ä½œæˆã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰æ›ã•ã‚Œã¾ã™ã€‚</p>
<p>æ·»ä»˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã¯ç¬¬2å¼•æ•°ã®<a href="https://pkg.go.dev/github.com/mattermost/mattermost-server/v5/model#FileInfo"><code>*model.FileInfo</code></a>ã‹ã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ç¬¬3å¼•æ•°ã®<code>io.Reader</code>ã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›´ã‚’åŠ ãˆãŸå ´åˆã¯ã€ç¬¬4å¼•æ•°ã®<code>io.Writer</code>ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚
ã¾ãŸã€ãƒ•ã‚¡ã‚¤ãƒ«ã®æ·»ä»˜ã‚’æ‹’å¦ã™ã‚‹å ´åˆã¯ã€2ã¤ç›®ã®è¿”å´å€¤ã«ç©ºã§ãªã„æ–‡å­—åˆ—ã‚’æŒ‡å®šã—ã¾ã™ã€‚1ã¤ç›®ã®è¿”å´å€¤ã®<code>*model.FileInfo</code>ã«ã¯å†…å®¹ã‚’ç·¨é›†ã—ãŸå¾Œã®<code>*model.FileInfo</code>ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã‚‚ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸå ´åˆã€ç·¨é›†å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã«ã¤ã„ã¦ã¯è‡ªå‹•ã§æ›´æ–°ã•ã‚Œã‚‹ãŸã‚ã€<code>FileWillBeUploaded</code>å†…ã§è¨ˆç®—ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
<p>ç”»åƒã«ãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‹ã‘ã‚‹ä¾‹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<p><img src="https://blog.kaakaa.dev/images/posts/advent-calendar-2020/day18/file-will-be-uploaded.png" alt="IMAGE"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">SamplePlugin</span>) <span style="color:#a6e22e">FileWillBeUploaded</span>(<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">plugin</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">info</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FileInfo</span>, <span style="color:#a6e22e">file</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Reader</span>, <span style="color:#a6e22e">output</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Writer</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">FileInfo</span>, <span style="color:#66d9ef">string</span>) {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">info</span>.<span style="color:#a6e22e">IsImage</span>() {
		<span style="color:#75715e">// Decode original image
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">img</span>, <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Decode</span>(<span style="color:#a6e22e">file</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">API</span>.<span style="color:#a6e22e">LogWarn</span>(<span style="color:#e6db74">&#34;failed to decode uploaded image&#34;</span>, <span style="color:#e6db74">&#34;details&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#e6db74">&#34;&#34;</span>
		}
		<span style="color:#75715e">// Draw original image
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">base</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">NewRGBA</span>(<span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Dx</span>(), <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Dy</span>()))
		<span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Draw</span>(<span style="color:#a6e22e">base</span>, <span style="color:#a6e22e">base</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">img</span>, <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">ZP</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Src</span>)

		<span style="color:#75715e">// Create green filter
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">src</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">NewRGBA</span>(<span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Dx</span>(), <span style="color:#a6e22e">img</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Dy</span>()))
		<span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Draw</span>(<span style="color:#a6e22e">src</span>, <span style="color:#a6e22e">src</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Uniform</span>{<span style="color:#a6e22e">color</span>.<span style="color:#a6e22e">RGBA</span>{<span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">128</span>}}, <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">ZP</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Src</span>)

		<span style="color:#75715e">// Mask original image
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">mask</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">Rect</span>(<span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">25</span>, <span style="color:#a6e22e">base</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Dx</span>()<span style="color:#f92672">-</span><span style="color:#ae81ff">25</span>, <span style="color:#a6e22e">base</span>.<span style="color:#a6e22e">Bounds</span>().<span style="color:#a6e22e">Dy</span>()<span style="color:#f92672">-</span><span style="color:#ae81ff">25</span>)
		<span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">DrawMask</span>(<span style="color:#a6e22e">base</span>, <span style="color:#a6e22e">base</span>.<span style="color:#a6e22e">Bounds</span>(), <span style="color:#a6e22e">src</span>, <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">ZP</span>, <span style="color:#a6e22e">mask</span>, <span style="color:#a6e22e">image</span>.<span style="color:#a6e22e">ZP</span>, <span style="color:#a6e22e">draw</span>.<span style="color:#a6e22e">Over</span>)

		<span style="color:#75715e">// Write masked image
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">png</span>.<span style="color:#a6e22e">Encode</span>(<span style="color:#a6e22e">output</span>, <span style="color:#a6e22e">base</span>)
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">info</span>, <span style="color:#e6db74">&#34;&#34;</span>
}
</code></pre></div><p>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®Exifã‚’å‰Šé™¤ã™ã‚‹ãªã©ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€å‡¦ç†è‡ªä½“ã¯Mattermostã‚µãƒ¼ãƒãƒ¼ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒé€ã‚‰ã‚ŒãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p>
<h2 id="ã•ã„ã”ã«">ã•ã„ã”ã«</h2>
<p>æœ¬æ—¥ã¯ã€Mattermost Pluginã®Server Hooksã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã—ãŸã€‚
æ˜æ—¥ã‚‚ã€Mattermost Pluginã®<strong>Server</strong>ã‚µã‚¤ãƒ‰ã§ä½¿ç”¨ã§ãã‚‹APIã¨Helperé–¢æ•°ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚</p>



      
        <div class="blog-tags">
          
            <a
              href="https://blog.kaakaa.dev/tags/mattermost/"
              >mattermost</a
            >&nbsp;
          
            <a
              href="https://blog.kaakaa.dev/tags/integration/"
              >integration</a
            >&nbsp;
          
            <a
              href="https://blog.kaakaa.dev/tags/plugin/"
              >plugin</a
            >&nbsp;
          
            <a
              href="https://blog.kaakaa.dev/tags/server/"
              >server</a
            >&nbsp;
          
            <a
              href="https://blog.kaakaa.dev/tags/hooks/"
              >hooks</a
            >&nbsp;
          
        </div>
      
    </article>
    
    
      
  <div id="disqus_thread"></div>
  <script type="text/javascript">
        (function() {
            
            
            if (window.location.hostname == "localhost") return;

            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            var disqus_shortname = 'kaakaa-blog';
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
  <noscript
    >Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript"
      >comments powered by Disqus.</a
    ></noscript
  >
  <a href="https://disqus.com/" class="dsq-brlink"
    >comments powered by <span class="logo-disqus">Disqus</span></a
  >


    
  </div>

    <footer>
  

<div class="social-icons">
  
    
    
      
      <a href="https://github.com/kaakaa" name="GitHub">
        <em class="fab fa-github-alt fa-lg"></em>
      </a>
    
       &nbsp;&ndash;&nbsp;
      <a href="https://twitter.com/kaakaa_hoe_prog" name="Twitter">
        <em class="fab fa-twitter fa-lg"></em>
      </a>
    
  

  
    
    
       &nbsp;&ndash;&nbsp; 
      <a class="social-icon" href="https://zenn.dev/kaakaa" name="Zenn">
        <img
          src="https://blog.kaakaa.dev/images/zenn.svg"
          alt="Zenn"
        />
      </a>
    
       &nbsp;&ndash;&nbsp; 
      <a class="social-icon" href="https://twitter.com/kaakaa_hoe_prog" name="Qiita">
        <img
          src="https://blog.kaakaa.dev/images/qiita.png"
          alt="Qiita"
        />
      </a>
    
  
</div>


  
  <div class="container">
    <p class="credits copyright">
      <a href="https://blog.kaakaa.dev/about">Yusuke Nemoto</a>
      &nbsp;&copy;
      2023
      
        &nbsp;/&nbsp;
        <a href="https://blog.kaakaa.dev/">kaakaa blog</a>
      
      &nbsp;&ndash;&nbsp;
      <em class="fas fa-moon" id="dark-mode-toggle"></em>
    </p>

    <p class="credits theme-by">
      Powered By <a href="https://gohugo.io">Hugo</a>&nbsp;
      Theme
      <a href="https://github.com/matsuyoshi30/harbor">Harbor</a>
    </p>
  </div>
</footer>

  </body>
</html>
