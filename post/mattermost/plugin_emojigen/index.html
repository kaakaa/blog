<!doctype html><html lang=ja-jp>
<head>
<meta charset=utf-8>
<title>Mattermost EmojiGen plugin</title>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7H97CTR9R6"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-7H97CTR9R6')</script>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=alternate type=application/rss+xml href=https://blog.kaakaa.dev/index.xml title="kaakaa blog">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Mattermost EmojiGen plugin">
<meta name=twitter:description content="Mattermost EmojiGen Mattermost 上でテキストから絵文字を作成できるプラグインを作ってた。 下記にスクリーンキャストを載せてる。 kaakaa/mattermost-emojigen: Creating custom emoji from slash command 2 年前ぐらいに作ってたやつだ">
<meta property="og:title" content="Mattermost EmojiGen plugin">
<meta property="og:description" content="Mattermost EmojiGen Mattermost 上でテキストから絵文字を作成できるプラグインを作ってた。 下記にスクリーンキャストを載せてる。 kaakaa/mattermost-emojigen: Creating custom emoji from slash command 2 年前ぐらいに作ってたやつだ">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.kaakaa.dev/post/mattermost/plugin_emojigen/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-03-20T15:05:21+09:00">
<meta property="article:modified_time" content="2021-03-20T15:05:21+09:00">
<link rel=stylesheet href=https://blog.kaakaa.dev/fontawesome/css/all.min.css>
<link id=dark-mode-theme rel=stylesheet href=https://blog.kaakaa.dev/css/dark.css>
<script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script>
<script src=https://blog.kaakaa.dev/js/main.bundle.js></script>
<script src=https://blog.kaakaa.dev/js/instantpage.min.js type=module defer></script>
<meta name=generator content="Hugo 0.91.2">
</head>
<body>
<header>
<nav class=navbar>
<div class=nav>
<a href=https://blog.kaakaa.dev/ class=nav-logo>
<img src=https://blog.kaakaa.dev/images/icon.png width=50 height=50 alt=Logo>
</a>
<ul class=nav-links>
<li>
<a href=/ id=Home><em class="fas fa-home fa-lg"></em></a>
</li>
<li>
<a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a>
</li>
<li>
<a href=/tags/ id=Tags><em class="fas fa-tag fa-lg"></em></a>
</li>
<li>
<a href=/search/ id=Search><em class="fas fa-search fa-lg"></em></a>
</li>
<li>
<a href=/index.xml id=Subscribe><em class="fas fa-rss fa-lg"></em></a>
</li>
</ul>
</div>
</nav>
<div class=intro-header>
<div class=container>
<div class=post-heading>
<h1>
Mattermost EmojiGen plugin
</h1>
<span class=meta-post>
<em class="fa fa-calendar-alt"></em>&nbsp;Mar 20, 2021
</span>
</div>
</div>
</div>
</header>
<div class=container role=main>
<article class=article class=blog-post>
<nav id=TableOfContents>
<ul>
<li><a href=#mattermost-emojigen>Mattermost EmojiGen</a>
<ul>
<li><a href=#no-bot>No bot&mldr;</a></li>
<li><a href=#circleci>CircleCI</a></li>
<li><a href=#github-release>GitHub Release</a></li>
</ul>
</li>
<li><a href=#まとめ>まとめ</a></li>
</ul>
</nav><h2 id=mattermost-emojigen>Mattermost EmojiGen</h2>
<p>Mattermost 上でテキストから絵文字を作成できるプラグインを作ってた。<br>
下記にスクリーンキャストを載せてる。</p>
<p><a href=https://github.com/kaakaa/mattermost-emojigen#usage>kaakaa/mattermost-emojigen: Creating custom emoji from slash command</a></p>
<p>2 年前ぐらいに作ってたやつだけど、久しぶりに引っ張り出してゴリゴリと。以前、何かができなくて諦めてた気がするけど、そんなに大きな問題なく手当て完了。</p>
<p>主な変更点は、今まで 2x2 の 4 文字までの絵文字しか作れなかったけど、上限文字数を撤廃。3x3 の<code>圧倒的当事者意識</code>的な絵文字も作れるようにした。とはいえ、視認性的に 3x3 でも厳しいぐらいだと思うけど。</p>
<p>Go 言語で文字画像作るのは、文字数と描画位置をどのように決めるかとの戦い。テストコード書いて画像出力させながらゴリゴリ調整。脳筋。</p>
<p><a href=https://github.com/kaakaa/mattermost-emojigen/commit/21fd13ada28106ca1b7fcd3d0279cfef1e90ed11#diff-285e170643d9e80db83915466e06d2269d66a6cd59a3140e9db79cf5b6d7f834R47>https://github.com/kaakaa/mattermost-emojigen/commit/21fd13ada28106ca1b7fcd3d0279cfef1e90ed11#diff-285e170643d9e80db83915466e06d2269d66a6cd59a3140e9db79cf5b6d7f834R47</a></p>
<h3 id=no-bot>No bot&mldr;</h3>
<p>Mattermost プラグインでは、Plugin 起動時にプラグイン専用の Bot アカウントを作成して、その Bot から<a href=https://developers.mattermost.com/extend/plugins/server/reference/#API>Plugin API</a>を叩かせて処理をやらせるというのが一般的だけど、悲しいことに絵文字登録 API が<a href=https://developers.mattermost.com/extend/plugins/server/reference/#API>Plugin API</a>として実装されていなかったので、プラグインの設定画面にアクセストークンを入力して、絵文字登録は REST API 経由で実行するという方式を取っている。</p>
<p>そのため、セットアップ手順がちょっと面倒臭くなっている。REST API のなかで、Plugin API に実装されているものとされていないものの違いがわからないんだよな。Contribute しますって言えばやらせてもらえるのかな。</p>
<h3 id=circleci>CircleCI</h3>
<p>久しぶりに CircleCI 回したらビルドがコケる。</p>
<pre tabindex=0><code>...
Warning: Permanently added the RSA host key for IP address '140.82.112.3' to the list of known hosts.
Permission denied (publickey).
fatal: Could not read from remote repository.
...
</code></pre><p>Deploy Key を作り直せば良かったらしい。</p>
<p><a href=https://scrapbox.io/nwtgck/CircleCI%E3%81%A7checkout%E6%99%82%E3%81%AB%E3%80%8Cfatal:_Could_not_read_from_remote_repository.%E3%80%8D%E5%87%BA%E3%82%8B%EF%BC%88%E9%95%B7%E3%81%8F%E6%94%BE%E7%BD%AE%E3%81%97%E3%81%A6%E3%81%84%E3%81%9F%E6%99%82%E3%81%AB%E7%99%BA%E7%94%9F%EF%BC%89>CircleCI で checkout 時に「fatal: Could not read from remote repository.」出る（長く放置していた時に発生） - nwtgck / Ryo Ota</a></p>
<h3 id=github-release>GitHub Release</h3>
<p>tag 打っても Release Job が走らない。</p>
<p>基本、Mattermost Plugin 関連のファイルは <a href=https://github.com/mattermost/mattermost-plugin-starter-template>mattermost-plugin-starter-template</a> から取って来るけど、このリポジトリにある Circle の設定ファイルには Release Job が定義されていなかった。</p>
<p>使い慣れた？ Matterpoll の方の設定ファイルを持ってくる。</p>
<p><a href=https://github.com/matterpoll/matterpoll/blob/master/.circleci/config.yml>https://github.com/matterpoll/matterpoll/blob/master/.circleci/config.yml</a></p>
<p><code>mattermost/plugin-ci</code>の Circle CI Orb は、最新バージョン<code>v0.1.6</code>まで進んでるんだけど、新しめのやつ(<code>v0.1.2</code>とかだったかな?)になると Mattermost 社の S3 インスタンスとかにアクセスしようとするので、認証情報設定しておかないとエラーになるのよね。なので一般コントリビュータは<code>v0.1.0</code>を使うしかない（と思う）。
ここら辺、ちゃんとドキュメント化されてないから手探りなのよね。</p>
<h2 id=まとめ>まとめ</h2>
<p>Go で画像生成できるのが面白くて作り始めた気がするけど、まぁとりあえず形にはなったかな。ちゃんとテスト書いてないし、ちょっと操作性が微妙な気はするけど。</p>
<p>言葉の絵文字が流行るのは日本的、というか漢字文化だよなぁ。</p>
<div class=blog-tags>
<a href=https://blog.kaakaa.dev/tags/mattermost/>mattermost</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/plugin/>plugin</a>&nbsp;
<a href=https://blog.kaakaa.dev/tags/emoji/>emoji</a>&nbsp;
</div>
</article>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='kaakaa-blog',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<footer>
<div class=social-icons>
<a href=https://github.com/kaakaa name=GitHub>
<em class="fab fa-github-alt fa-lg"></em>
</a>
&nbsp;&ndash;&nbsp;
<a href=https://twitter.com/kaakaa_hoe_prog name=Twitter>
<em class="fab fa-twitter fa-lg"></em>
</a>
&nbsp;&ndash;&nbsp;
<a class=social-icon href=https://zenn.dev/kaakaa name=Zenn>
<img src=https://blog.kaakaa.dev/images/zenn.svg alt=Zenn>
</a>
&nbsp;&ndash;&nbsp;
<a class=social-icon href=https://twitter.com/kaakaa_hoe_prog name=Qiita>
<img src=https://blog.kaakaa.dev/images/qiita.png alt=Qiita>
</a>
</div>
<div class=container>
<p class="credits copyright">
<a href=https://blog.kaakaa.dev/about>Yusuke Nemoto</a>
&nbsp;&copy;
2024
&nbsp;/&nbsp;
<a href=https://blog.kaakaa.dev/>kaakaa blog</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em>
</p>
<p class="credits theme-by">
Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a>
</p>
</div>
</footer>
</body>
</html>