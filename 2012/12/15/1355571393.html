<!DOCTYPE html>
<html>
  <head>
    <title>
      KS Sample
    </title>
    <meta chearset="UTF-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <link href="/css/kickstart.css" media="all" rel="stylesheet" type="text/css" />
    <link href="/style.css" media="all" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/kickstart.js" type="text/javasript"></script>
  </head>
  <body class="elements">
    <div class="callout clearfix">
      <h1>
        びぼーろく（仮）
      </h1>
      <div class="grid">
        <div class="col_12">
          <ul class="tabs right">
            <li>
              <a href="tab_blog"><i class="icon-file"></i>BLOG</a>
            </li>
            <li>
              <a href="tab_socials"><i class="icon-twitter"></i>SOCIALS</a>
            </li>
            <li>
              <a href="https://github.com/kaakaa/middleman-blog-slim-sample/tree/gh-pages"><i class="icon-github"></i>View on Gitub</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="grid">
      <div class="col_12"><p>Gradle Effective Implementation Guideの第7章を参考に。</p>

<p>ディレクトリ構成は以下。</p>

<pre><code>flower/
tree/
master/
  settings.gradle
  build.gradle
</code></pre>

<p>flowerプロジェクトとtreeプロジェクトのビルドを統括するmasterプロジェクトを作る。</p>

<h4 id="section">マルチプロジェクトの定義</h4>

<p>settings.gradleでflowerとtreeとmasterがマルチプロジェクトであることをmasterディレクトリ配下のsettings.gradleに定義。</p>

<p>~~~~ {.syntax-highlight}
includeFlat 'tree', 'flower'
~~~~</p>

<p>もし、masterとtree/flowerが以下のようなディレクトリ構成の場合</p>

<pre><code>master/
  flower/
  tree/
</code></pre>

<p>settings.gradleの中身は以下のようになる。</p>

<p>~~~~ {.syntax-highlight}
include 'tree', 'flower'
~~~~</p>

<h4 id="section-1">マルチプロジェクトの処理</h4>

<p>依存関係を定義してあげると、ひとつのbuild.gradleファイルにマルチプロジェクトすべての処理を書くことが出来る。</p>

<p>~~~~ {.syntax-highlight}
allprojects{
        task printInfo « {
                println "This is ${project.name}"
        }
}</p>

<p>subprojects{
        printInfo « {
                println "Can be planted"
        }
}
~~~~</p>

<p>allprojectsブロックでマルチプロジェクト内のすべてのプロジェクトに対してタスクを定義出来る。</p>

<p>subprojectsブロックでは、マルチプロジェクトにおける自プロジェクト意外のプロジェクトに対してのみタスクを定義出来る。（この場合、flower/treeロジェクト）</p>

<p>もちろん、各プロジェクトにbuild.gradleを置いてあげてもOK。</p>

<p>\</p>

<h4 id="section-2">マルチプロジェクトビルドの実行</h4>

<p>上記ファイルを用意した後、masterディクレクトリで以下のprintInfoタスクを実行してみる。</p>

<pre><code>kaakaa_hoe@[master]$ gradle printInfo
:printInfo
This is master
:flower:printInfo
This is flower
Can be planted
:tree:printInfo
This is tree
Can be planted
</code></pre>

<p>すると、masterプロジェクトを筆頭にすべてのプロジェクトのprintInfoタスクを実行する。</p>

<p>タスクが実行される順番は、親プロジェクトとなるmasterが一番最初に実行されて、その後はプロジェクト名のアルファベット順で実行される。</p>

<p>もちろんdependsOnを設定してあげることで実行順を制御することが出来る。</p>

<p>サブプロジェクトのタスクのみを実行したい場合は</p>

<pre><code>kaakaa_hoe@[master]$ gradle :flower:printInfo
:flower:printInfo
This is flower
Can be planted

BUILD SUCCESSFUL

Total time: 2.533 secs
</code></pre>

<p>次にflowerディレクトリでタスクを実行してみる。</p>

<pre><code>kaakaa_hoe@[flower]$ gradle printInfo
:flower:printInfo
This is flower
Can be planted

BUILD SUCCESSFUL

Total time: 2.508 secs
</code></pre>

<p>面白いのはflowerディレクトリ配下にはbuild.gradleファイルが存在しないのに、タスクが実行出来ること。</p>

<p>これはGradleが自動で対象プロジェクトがマルチプロジェクトに含まれているかを確認してくれるため。</p>

<p>なので、各プロジェクトにbuild.graldeを投げなくても、settings.gradleとbuild.gradleを含むディレクトリを各プロジェクトとフラットな場所に投げてあげれば、すべてのプロジェクトでgradleタスクを作成することが出来る。</p>

<p>ちょっとbuild.gradleファイルが長くなりそうだけど。</p>

<p>ビルドの依存関係とか成果物に関しても色々設定できるみたいなので、上手く使えれば便利そうですね。</p>

<p>\</p>

<p>ただ、flowerディレクトリを削除して、masterディレクトリでprintInfoタスクを実行しても同じ結果が得られる。</p>

<p>ディレクトリ構成</p>

<pre><code>tree/
master/
  settings.gradle
  build.gradle
</code></pre>

<p>settings.gradle,build.gradleは上記のまま。</p>

<p>実行</p>

<pre><code>kaakaa_hoe@[master]$ gradle printInfo
:printInfo
This is master
:flower:printInfo
This is flower
Can be planted
:tree:printInfo
This is tree
Can be planted

BUILD SUCCESSFUL

Total time: 2.53 secs
</code></pre>

<p>マルチプロジェクトで実行しても実際のディレクトリを見に行ってるわけではない？</p>

<p>ちょっと確認。</p>

<p>build.gradleファイルにのallprojectsブロックに以下のタスクを追加。</p>

<p>~~~~ {.syntax-highlight}
        task hasHoge « {
                def file = file(new File('hoge.txt'))
                println "${project.name} has hoge? =&gt; ${file.exists()}"
        }
~~~~</p>

<p>まずは、flowerプロジェクトがある状態で実行。</p>

<pre><code>flower/
  hoge.txt
tree/
  hoge.txt
master/
  hoge.txt
  settings.gradle
  build.gradle
</code></pre>

<p>結果</p>

<pre><code>kaakaa_hoe@[master]$ gradle hasHoge
:hasHoge
master has hoge? =&gt; true
:flower:hasHoge
flower has hoge? =&gt; true
:tree:hasHoge
tree has hoge? =&gt; true

BUILD SUCCESSFUL

Total time: 3.344 secs
</code></pre>

<p>flowerディレクトリを削除して実行。</p>

<pre><code>kaakaa_hoe@[master]$ gradle hasHoge
:hasHoge
master has hoge? =&gt; true
:flower:hasHoge
flower has hoge? =&gt; false
:tree:hasHoge
tree has hoge? =&gt; true

BUILD SUCCESSFUL

Total time: 2.496 secs
</code></pre>

<p>ほぅ。</p>

<p>ちゃんと見に行けてる。</p>

<p>ということは指定されたプロジェクトが存在しない場合でも、そのプロジェクトに対するタスクは定義できるってことか。ちょっと気持ち悪い気がする。</p>

<p><a href="http://b.hatena.ne.jp/entry/http://d.hatena.ne.jp" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" /></a></p>

<p><a href="http://twitter.com/share">ツイートする</a></p>

      </div>
      <hr />
      <div class="col_12">
        <div class="col_4">
          <h4>
            Profile
          </h4>
          <img class="align-center" src="http://placehold.it/169x130/4D99E0/ffffff.png&text=full+width" />
          <p>
            live in Yokohama. Software Engineer. Java / Groovy / Ruby / Sinatra / Trac / Jenkins
          </p>
        </div>
        <div class="col_5">
          <h5>
            Recent Articles
          </h5>
          <ul class="alt">
            <li>
              <a href="/2013/10/07/example-article.html">Example Article</a>
            </li>
            <li>
              <a href="/2013/10/06/example-article.html">Example Article</a>
            </li>
            <li>
              <a href="/2013/10/05/example-article.html">Example Article</a>
            </li>
            <li>
              <a href="/2013/09/24/1380029870.html">Githubリポジトリのデフォルトブランチを変更する</a>
            </li>
            <li>
              <a href="/2013/09/15/20130915.html">Sinatraアプリを定期的に実行するために泥臭く行ってみた</a>
            </li>
            <li>
              <a href="/2013/09/10/20130910.html">Node.js(Express)でフィードアグリゲータを作り始め</a>
            </li>
            <li>
              <a href="/2013/09/03/20130903.html">SinatraでFeedAggregator</a>
            </li>
            <li>
              <a href="/2013/08/19/1376919346.html">社内勉強会 - 書籍管理Webシステム</a>
            </li>
            <li>
              <a href="/2013/07/18/1374154333.html">Gitbucket1.2で500エラー</a>
            </li>
            <li>
              <a href="/2013/06/24/20130624.html">社内勉強会 - chef</a>
            </li>
            <li>
              <a href="/2013/06/09/1370708167.html">vagrant&chefで構築した仮想CentOS上JenkinsでGoogle Testを実行</a>
            </li>
          </ul>
        </div>
        <div class="col_3">
          <h5>
            By Year
          </h5>
          <ul class="alt">
            <li>
              <a href="/2013.html">2013</a>(24)
            </li>
            <li>
              <a href="/2012.html">2012</a>(81)
            </li>
            <li>
              <a href="/2011.html">2011</a>(31)
            </li>
          </ul>
        </div>
      </div>
    </div>
    <hr />
    <div class="footer">
      <p>
        &copy; Copyright 2013 kaakaa
      </p>
    </div>
  </body>
</html>