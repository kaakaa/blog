<!DOCTYPE html>
<html>
  <head>
    <title>
      KS Sample
    </title>
    <meta chearset="UTF-8" />
    <meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" />
    <link href="/css/kickstart.css" media="all" rel="stylesheet" type="text/css" />
    <link href="/style.css" media="all" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/kickstart.js" type="text/javasript"></script>
  </head>
  <body class="elements">
    <div class="callout clearfix">
      <h1>
        びぼーろく（仮）
      </h1>
      <div class="grid">
        <div class="col_12">
          <ul class="tabs right">
            <li>
              <a href="tab_blog"><i class="icon-file"></i>BLOG</a>
            </li>
            <li>
              <a href="tab_socials"><i class="icon-twitter"></i>SOCIALS</a>
            </li>
            <li>
              <a href="https://github.com/kaakaa/middleman-blog-slim-sample/tree/gh-pages"><i class="icon-github"></i>View on Gitub</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="grid">
      <div class="col_12"><p>会社で<a href="https://github.com/takezoe/gitbucket">Gitbucket</a>を試用しているのですが、</p>

<p>ある日、TOPページにアクセスしようとすると500エラーを返すようになりました。</p>

<p>どうやら、メンバがSourceTreeからGitbucketに対して</p>

<p>プッシュやタグ付けをしていたら、500エラーを返すようになった模様。</p>

<p>500エラーを返すのは下記ページのみっぽい。</p>

<ul>
  <li>Gitbucketトップページ</li>
  <li>上記メンバのPublic Activityページ</li>
</ul>

<p>スタックトレースは以下。</p>

<pre><code>HTTPステータス 500 - String index out of range: 40
 
type 例外レポート
 
メッセージ String index out of range: 40
 
説明 The server encountered an internal error that prevented it from fulfilling this request.
 
例外
 
java.lang.StringIndexOutOfBoundsException: String index out of range: 40
java.lang.String.substring(Unknown Source)
helper.html.activities$$anonfun$apply$1$$anonfun$apply$2$$anonfun$apply$3.apply(activities.template.scala:38)
helper.html.activities$$anonfun$apply$1$$anonfun$apply$2$$anonfun$apply$3.apply(activities.template.scala:36)
scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
scala.collection.IndexedSeqOptimized$class.foreach(IndexedSeqOptimized.scala:33)
scala.collection.mutable.ArrayOps$ofRef.foreach(ArrayOps.scala:105)
scala.collection.TraversableLike$class.map(TraversableLike.scala:244)
scala.collection.mutable.ArrayOps$ofRef.map(ArrayOps.scala:105)
helper.html.activities$$anonfun$apply$1$$anonfun$apply$2.apply(activities.template.scala:36)
helper.html.activities$$anonfun$apply$1$$anonfun$apply$2.apply(activities.template.scala:26)
scala.Option.map(Option.scala:145)
helper.html.activities$$anonfun$apply$1.apply(activities.template.scala:26)
helper.html.activities$$anonfun$apply$1.apply(activities.template.scala:22)
scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
scala.collection.immutable.List.foreach(List.scala:318)
scala.collection.TraversableLike$class.map(TraversableLike.scala:244)
scala.collection.AbstractTraversable.map(Traversable.scala:105)
helper.html.activities$.apply(activities.template.scala:22)
html.index$.apply(index.template.scala:26)
app.IndexControllerBase$$anonfun$1.apply(IndexController.scala:12)
app.IndexControllerBase$$anonfun$1.apply(IndexController.scala:12)
org.scalatra.ScalatraBase$class.org$scalatra$ScalatraBase$$liftAction(ScalatraBase.scala:183)
org.scalatra.ScalatraBase$$anonfun$invoke$1.apply(ScalatraBase.scala:178)
org.scalatra.ScalatraBase$$anonfun$invoke$1.apply(ScalatraBase.scala:178)
org.scalatra.ApiFormats$class.withRouteMultiParams(ApiFormats.scala:175)
app.ControllerBase.withRouteMultiParams(ControllerBase.scala:13)
org.scalatra.ScalatraBase$class.invoke(ScalatraBase.scala:177)
app.ControllerBase.org$scalatra$json$JsonSupport$$super$invoke(ControllerBase.scala:13)
org.scalatra.json.JsonSupport$$anonfun$invoke$1.apply(JsonSupport.scala:65)
org.scalatra.json.JsonSupport$$anonfun$invoke$1.apply(JsonSupport.scala:57)
org.scalatra.ApiFormats$class.withRouteMultiParams(ApiFormats.scala:175)
app.ControllerBase.withRouteMultiParams(ControllerBase.scala:13)
org.scalatra.json.JsonSupport$class.invoke(JsonSupport.scala:57)
app.ControllerBase.invoke(ControllerBase.scala:13)
org.scalatra.ScalatraBase$$anonfun$runRoutes$1$$anonfun$apply$3.apply(ScalatraBase.scala:163)
org.scalatra.ScalatraBase$$anonfun$runRoutes$1$$anonfun$apply$3.apply(ScalatraBase.scala:162)
scala.Option.flatMap(Option.scala:170)
org.scalatra.ScalatraBase$$anonfun$runRoutes$1.apply(ScalatraBase.scala:162)
org.scalatra.ScalatraBase$$anonfun$runRoutes$1.apply(ScalatraBase.scala:161)
scala.collection.immutable.Stream.flatMap(Stream.scala:442)
org.scalatra.ScalatraBase$class.runRoutes(ScalatraBase.scala:161)
app.ControllerBase.runRoutes(ControllerBase.scala:13)
org.scalatra.ScalatraBase$class.executeRoutes(ScalatraBase.scala:114)
app.ControllerBase.executeRoutes(ControllerBase.scala:13)
org.scalatra.ScalatraBase$$anonfun$handle$1.apply$mcV$sp(ScalatraBase.scala:80)
org.scalatra.ScalatraBase$$anonfun$handle$1.apply(ScalatraBase.scala:80)
org.scalatra.ScalatraBase$$anonfun$handle$1.apply(ScalatraBase.scala:80)
scala.util.DynamicVariable.withValue(DynamicVariable.scala:57)
org.scalatra.DynamicScope$class.withResponse(DynamicScope.scala:80)
app.ControllerBase.withResponse(ControllerBase.scala:13)
org.scalatra.DynamicScope$$anonfun$withRequestResponse$1.apply(DynamicScope.scala:60)
scala.util.DynamicVariable.withValue(DynamicVariable.scala:57)
org.scalatra.DynamicScope$class.withRequest(DynamicScope.scala:71)
app.ControllerBase.withRequest(ControllerBase.scala:13)
org.scalatra.DynamicScope$class.withRequestResponse(DynamicScope.scala:59)
app.ControllerBase.withRequestResponse(ControllerBase.scala:13)
org.scalatra.ScalatraBase$class.handle(ScalatraBase.scala:78)
app.ControllerBase.org$scalatra$servlet$ServletBase$$super$handle(ControllerBase.scala:13)
org.scalatra.servlet.ServletBase$class.handle(ServletBase.scala:43)
app.ControllerBase.handle(ControllerBase.scala:13)
org.scalatra.ScalatraFilter$$anonfun$doFilter$1.apply$mcV$sp(ScalatraFilter.scala:33)
org.scalatra.ScalatraFilter$$anonfun$doFilter$1.apply(ScalatraFilter.scala:33)
org.scalatra.ScalatraFilter$$anonfun$doFilter$1.apply(ScalatraFilter.scala:33)
scala.util.DynamicVariable.withValue(DynamicVariable.scala:57)
org.scalatra.ScalatraFilter$class.doFilter(ScalatraFilter.scala:32)
app.ControllerBase.doFilter(ControllerBase.scala:13)
servlet.TransactionFilter$$anonfun$doFilter$1.apply$mcV$sp(TransactionFilter.scala:30)
servlet.TransactionFilter$$anonfun$doFilter$1.apply(TransactionFilter.scala:28)
servlet.TransactionFilter$$anonfun$doFilter$1.apply(TransactionFilter.scala:28)
scala.slick.session.BaseSession.withTransaction(Session.scala:236)
scala.slick.session.Database$$anonfun$withTransaction$2.apply(Database.scala:58)
scala.util.DynamicVariable.withValue(DynamicVariable.scala:57)
scala.slick.session.Database$$anonfun$withSession$1.apply(Database.scala:46)
scala.slick.session.Database$$anonfun$withSession$1.apply(Database.scala:46)
scala.slick.session.Database.withSession(Database.scala:38)
scala.slick.session.Database.withSession(Database.scala:46)
scala.slick.session.Database.withTransaction(Database.scala:58)
servlet.TransactionFilter.doFilter(TransactionFilter.scala:28)
注意 原因のすべてのスタックトレースは、Apache Tomcat/7.0.42のログに記録されています
 
Apache Tomcat/7.0.42
</code></pre>

<p>スタックトレースからソースを参照してみると、</p>

<p>コミットへのリンクを生成する所でエラーが出ている様子。</p>

<p>SourceTreeだから起きる事象なのかは不明。</p>

<p>GitbucketのDB内のActivityテーブルの中が見れれば、なんとなく分かりそうだけど、</p>

<p>DB力が足りずにぐぬぬってなってる。</p>

<p><a href="http://b.hatena.ne.jp/entry/http://d.hatena.ne.jp" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" /></a></p>

<p><a href="http://twitter.com/share">ツイートする</a></p>

      </div>
      <hr />
      <div class="col_12">
        <div class="col_4">
          <h4>
            Profile
          </h4>
          <img class="align-center" src="http://placehold.it/169x130/4D99E0/ffffff.png&text=full+width" />
          <p>
            live in Yokohama. Software Engineer. Java / Groovy / Ruby / Sinatra / Trac / Jenkins
          </p>
        </div>
        <div class="col_5">
          <h5>
            Recent Articles
          </h5>
          <ul class="alt">
            <li>
              <a href="/2013/10/10/webfrontier_seminar.html">2013年秋 Web開発最前線テックトーク</a>
            </li>
            <li>
              <a href="/2013/10/07/example-article.html">Example Article</a>
            </li>
            <li>
              <a href="/2013/10/06/example-article.html">Example Article</a>
            </li>
            <li>
              <a href="/2013/10/05/example-article.html">Example Article</a>
            </li>
            <li>
              <a href="/2013/09/24/1380029870.html">Githubリポジトリのデフォルトブランチを変更する</a>
            </li>
            <li>
              <a href="/2013/09/15/20130915.html">Sinatraアプリを定期的に実行するために泥臭く行ってみた</a>
            </li>
            <li>
              <a href="/2013/09/10/20130910.html">Node.js(Express)でフィードアグリゲータを作り始め</a>
            </li>
            <li>
              <a href="/2013/09/03/20130903.html">SinatraでFeedAggregator</a>
            </li>
            <li>
              <a href="/2013/08/19/1376919346.html">社内勉強会 - 書籍管理Webシステム</a>
            </li>
            <li>
              <a href="/2013/07/18/1374154333.html">Gitbucket1.2で500エラー</a>
            </li>
            <li>
              <a href="/2013/06/24/20130624.html">社内勉強会 - chef</a>
            </li>
          </ul>
        </div>
        <div class="col_3">
          <h5>
            By Year
          </h5>
          <ul class="alt">
            <li>
              <a href="/2013.html">2013</a>(25)
            </li>
            <li>
              <a href="/2012.html">2012</a>(81)
            </li>
            <li>
              <a href="/2011.html">2011</a>(31)
            </li>
          </ul>
        </div>
      </div>
    </div>
    <hr />
    <div class="footer">
      <p>
        &copy; Copyright 2013 kaakaa
      </p>
    </div>
  </body>
</html>